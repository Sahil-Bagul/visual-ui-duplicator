
import { supabase } from '@/integrations/supabase/client';

/**
 * Check if courses are already set up
 */
const areCoursesSetUp = async (): Promise<boolean> => {
  const { data, error } = await supabase
    .from('courses')
    .select('id')
    .limit(1);
    
  if (error) {
    console.error('Error checking if courses exist:', error);
    return false;
  }
  
  return data && data.length > 0;
};

/**
 * Auto-generate content for "AI Tools for Students" course
 */
const setupAIToolsCourse = async () => {
  try {
    // Create course
    const { data: courseData, error: courseError } = await supabase
      .from('courses')
      .insert({
        title: 'AI Tools for Students',
        description: 'A beginner-friendly course to help students learn about the most useful AI tools for productivity, learning, and creativity.',
        price: 500,
        referral_reward: 250
      })
      .select();

    if (courseError) throw courseError;
    if (!courseData || courseData.length === 0) throw new Error("Failed to create course");

    const courseId = courseData[0].id;

    // Module 1: Introduction to AI
    const { data: module1Data, error: module1Error } = await supabase
      .from('course_modules')
      .insert({
        course_id: courseId,
        title: 'Introduction to AI',
        description: 'Learn the fundamentals of artificial intelligence and its applications',
        module_order: 1,
        content: 'This module introduces you to the basic concepts of artificial intelligence and how it applies to everyday life.'
      })
      .select();

    if (module1Error) throw module1Error;
    
    await supabase
      .from('lessons')
      .insert([
        {
          module_id: module1Data[0].id,
          title: 'What is Artificial Intelligence?',
          lesson_order: 1,
          content: 'Artificial Intelligence (AI) refers to computer systems designed to perform tasks that typically require human intelligence. These tasks include learning, reasoning, problem-solving, understanding language, and recognizing patterns.\n\nAt its core, AI is about creating machines that can "think" in ways similar to humans, though through different mechanisms. Modern AI systems use vast amounts of data and complex algorithms to make decisions or predictions.\n\nUnlike traditional software that follows explicit instructions, AI systems can adapt and improve over time based on experience. This capability makes them powerful tools for solving complex problems and automating tasks that were previously impossible for computers to handle.\n\nSome common examples of AI you likely encounter daily include virtual assistants (like Siri or Alexa), recommendation systems on streaming platforms, and predictive text on your smartphone.'
        },
        {
          module_id: module1Data[0].id,
          title: 'AI vs Automation',
          lesson_order: 2,
          content: 'While AI and automation are related concepts, they differ significantly in their capabilities and applications:\n\n‚Ä¢ Automation follows predefined rules to complete repetitive tasks without deviation. Think of it as a machine that performs the same action repeatedly, like an assembly line robot.\n\n‚Ä¢ AI, on the other hand, can learn, adapt, and make decisions based on data. It can handle variations and unpredictability by recognizing patterns and applying learned knowledge to new situations.\n\nKey differences:\n\n1. Decision-making: Automation executes fixed instructions, while AI can make judgments and adapt its approach.\n\n2. Data usage: Automation typically doesn\'t use data to improve, whereas AI systems learn from data to enhance their performance.\n\n3. Complexity: Automation handles straightforward, rule-based tasks, while AI can manage complex, nuanced problems.\n\n4. Flexibility: Automation breaks when conditions change, but AI can adjust to new circumstances.\n\nIn practice, many modern systems combine both approaches‚Äîusing automation for routine tasks and AI for more complex decision-making processes.'
        },
        {
          module_id: module1Data[0].id,
          title: 'Real-life Applications of AI',
          lesson_order: 3,
          content: 'AI has penetrated virtually every sector of our lives, transforming how we work, communicate, and make decisions:\n\nüéì Education\n‚Ä¢ Personalized learning platforms that adapt to student progress\n‚Ä¢ Automated grading systems that provide instant feedback\n‚Ä¢ Smart tutoring systems like Duolingo that adjust to learning patterns\n\nüè• Healthcare\n‚Ä¢ Disease diagnosis from medical imaging\n‚Ä¢ Drug discovery and development\n‚Ä¢ Personalized treatment recommendations\n\nüõí Retail and E-commerce\n‚Ä¢ Product recommendations based on browsing history\n‚Ä¢ Customer service chatbots\n‚Ä¢ Inventory management and demand forecasting\n\nüì± Technology\n‚Ä¢ Voice assistants (Siri, Google Assistant)\n‚Ä¢ Face recognition for device unlocking\n‚Ä¢ Smart email categorization and spam filtering\n\nüé≠ Entertainment\n‚Ä¢ Content recommendations on platforms like Netflix or Spotify\n‚Ä¢ AI-generated art, music, and writing\n‚Ä¢ Video game characters with adaptive behaviors\n\nüöó Transportation\n‚Ä¢ Navigation apps that predict traffic patterns\n‚Ä¢ Self-driving vehicle technology\n‚Ä¢ Ride-sharing price optimization\n\nThese applications demonstrate how AI has become an integral part of modern life, often working invisibly in the background to enhance our daily experiences.'
        },
        {
          module_id: module1Data[0].id,
          title: 'Benefits & Limitations of AI',
          lesson_order: 4,
          content: 'AI offers tremendous benefits but also comes with significant limitations that are important to understand:\n\n‚úÖ Benefits:\n\n‚Ä¢ Efficiency: AI can process vast amounts of data and perform tasks much faster than humans.\n\n‚Ä¢ Accuracy: In many specialized tasks, AI can achieve higher precision and consistency than human experts.\n\n‚Ä¢ Availability: AI systems can work 24/7 without fatigue or breaks.\n\n‚Ä¢ Scale: Once developed, AI solutions can be deployed widely at relatively low marginal cost.\n\n‚Ä¢ Innovation: AI enables new capabilities and services that weren\'t previously possible.\n\n‚ùå Limitations:\n\n‚Ä¢ Lack of Common Sense: AI struggles with basic reasoning that humans find intuitive.\n\n‚Ä¢ Data Dependency: AI systems are only as good as the data they\'re trained on and can perpetuate existing biases.\n\n‚Ä¢ Black Box Problem: Many AI models operate as "black boxes" where their decision-making process isn\'t transparent.\n\n‚Ä¢ Contextual Understanding: AI often fails to understand context, nuance, or subtle human emotions.\n\n‚Ä¢ Resource Intensity: Advanced AI requires significant computing power and energy resources.\n\n‚Ä¢ Ethical Concerns: AI raises important questions around privacy, surveillance, and automation of jobs.\n\nUnderstanding these trade-offs is crucial for making informed decisions about when and how to apply AI technologies in different contexts.'
        }
      ]);

    // Module 2: AI Tools Overview
    const { data: module2Data, error: module2Error } = await supabase
      .from('course_modules')
      .insert({
        course_id: courseId,
        title: 'AI Tools Overview',
        description: 'Explore different types of AI tools and how to choose the right ones',
        module_order: 2,
        content: 'This module helps you understand the landscape of AI tools available and how to select the ones that best suit your needs.'
      })
      .select();

    if (module2Error) throw module2Error;
    
    await supabase
      .from('lessons')
      .insert([
        {
          module_id: module2Data[0].id,
          title: 'Free vs Paid AI Tools',
          lesson_order: 1,
          content: 'When exploring AI tools, you\'ll encounter both free and paid options, each with distinct advantages and limitations:\n\nüÜì Free AI Tools:\n\n‚Ä¢ Advantages:\n  - No cost barrier to entry\n  - Great for learning and experimentation\n  - Often sufficient for basic tasks or occasional use\n  - Many offer limited versions of premium features\n\n‚Ä¢ Examples:\n  - ChatGPT (free tier)\n  - Canva (basic AI features)\n  - Quillbot (limited rewrites)\n  - Otter.ai (basic transcription)\n\n‚Ä¢ Limitations:\n  - Usage caps and quotas\n  - Limited features and capabilities\n  - Potentially slower processing\n  - Less customization options\n  - Possible data privacy concerns\n\nüí∞ Paid AI Tools:\n\n‚Ä¢ Advantages:\n  - More powerful features and capabilities\n  - Higher usage limits or unlimited use\n  - Better accuracy and performance\n  - Priority access to computing resources\n  - Enhanced privacy and security\n  - Dedicated customer support\n\n‚Ä¢ Examples:\n  - ChatGPT Plus ($20/month)\n  - Notion AI ($10/month)\n  - Grammarly Premium (~$12/month)\n  - Adobe Firefly (part of Creative Cloud)\n\n‚Ä¢ Considerations:\n  - Subscription costs add up quickly\n  - Some tools offer academic discounts\n  - Free trials often available to test before purchasing\n\nChoosing between free and paid options depends on:\n1. How frequently you\'ll use the tool\n2. The complexity of your needs\n3. Your budget constraints\n4. Privacy requirements\n\nPro tip: Start with free versions to understand your needs before investing in paid subscriptions.'
        },
        {
          module_id: module2Data[0].id,
          title: 'Choosing the Right Tool for the Task',
          lesson_order: 2,
          content: 'With the proliferation of AI tools, selecting the right one for your specific needs is crucial. Here\'s a framework to help you make informed choices:\n\n1Ô∏è‚É£ Identify Your Task Category:\n\n‚Ä¢ Text & Writing\n  - Essay writing and editing ‚Üí Grammarly, QuillBot\n  - Creative writing ‚Üí ChatGPT, Sudowrite\n  - Note-taking ‚Üí Notion AI, Mem.ai\n\n‚Ä¢ Visual & Design\n  - Image creation ‚Üí DALL-E, Midjourney\n  - Presentation design ‚Üí Beautiful.ai, Gamma\n  - Video editing ‚Üí Runway, Descript\n\n‚Ä¢ Research & Learning\n  - Information summarization ‚Üí Elicit, Scholarcy\n  - Language learning ‚Üí Duolingo, ChatGPT\n  - Math problem-solving ‚Üí Photomath, Microsoft Math\n\n‚Ä¢ Productivity\n  - Meeting transcription ‚Üí Otter.ai, Fireflies\n  - Email management ‚Üí Superhuman, Shortwave\n  - Calendar scheduling ‚Üí Clara, Reclaim.ai\n\n2Ô∏è‚É£ Evaluation Criteria:\n\n‚Ä¢ Accuracy: How precise and reliable are the results?\n‚Ä¢ Ease of use: Is the interface intuitive?\n‚Ä¢ Integration: Does it work with your existing tools?\n‚Ä¢ Cost: Is it within your budget?\n‚Ä¢ Privacy: How is your data handled?\n\n3Ô∏è‚É£ Testing Process:\n\n‚Ä¢ Start with a small, representative task\n‚Ä¢ Compare results from 2-3 different tools\n‚Ä¢ Consider both immediate output and learning curve\n\n4Ô∏è‚É£ Community Validation:\n\n‚Ä¢ Read recent reviews from similar users\n‚Ä¢ Check student forums for recommendations\n‚Ä¢ Look for tools with active development and updates\n\nRemember that the "right tool" may change as your skills advance and as AI technology continues to evolve rapidly.'
        },
        {
          module_id: module2Data[0].id,
          title: 'Safety and Privacy While Using AI Tools',
          lesson_order: 3,
          content: 'As AI tools become integral to academic and personal life, understanding their privacy and safety implications is essential:\n\nüîí Data Privacy Considerations\n\n‚Ä¢ Training Data Usage:\n  - Most AI tools learn from your inputs\n  - Your prompts may be stored and used for improving the model\n  - Read privacy policies to understand if/how your data is used\n\n‚Ä¢ Personal Information:\n  - Avoid sharing sensitive personal details (ID numbers, passwords)\n  - Be cautious about financial information\n  - Consider that conversations may not be completely private\n\n‚Ä¢ Academic Integrity:\n  - Some institutions track AI tool usage\n  - Many AI detectors exist that professors might use\n\nüõ°Ô∏è Safety Best Practices\n\n‚Ä¢ Create separate accounts for AI tools\n‚Ä¢ Use education-specific email addresses when available\n‚Ä¢ Consider privacy-focused alternatives when handling sensitive information\n‚Ä¢ Review and delete conversation history periodically\n‚Ä¢ Use browser privacy modes for one-time sensitive queries\n\nüì± Platform-Specific Considerations\n\n‚Ä¢ ChatGPT/OpenAI:\n  - Offers history deletion options\n  - Has academic focused settings\n\n‚Ä¢ Google Bard/Gemini:\n  - Connected to your Google account\n  - Review Google privacy settings\n\n‚Ä¢ Microsoft Copilot:\n  - Integrated with Microsoft ecosystem\n  - Check Microsoft account privacy settings\n\n‚Ä¢ Notion AI:\n  - Can access your entire workspace\n  - Review workspace sharing settings\n\n‚ö†Ô∏è Misinformation Awareness\n\n‚Ä¢ AI can generate convincing but incorrect information\n‚Ä¢ Verify important facts from traditional sources\n‚Ä¢ Be skeptical of AI-generated advice in specialized fields\n\nBy following these guidelines, you can enjoy the benefits of AI tools while minimizing potential privacy and safety risks.'
        }
      ]);

    // Module 3: AI for Learning and Productivity
    const { data: module3Data, error: module3Error } = await supabase
      .from('course_modules')
      .insert({
        course_id: courseId,
        title: 'AI for Learning and Productivity',
        description: 'Learn how to use AI tools to enhance your studies and boost productivity',
        module_order: 3,
        content: 'This module focuses on practical applications of AI tools for students, from getting help with academic subjects to improving your productivity.'
      })
      .select();

    if (module3Error) throw module3Error;
    
    await supabase
      .from('lessons')
      .insert([
        {
          module_id: module3Data[0].id,
          title: 'Using ChatGPT to Ask Questions',
          lesson_order: 1,
          content: 'ChatGPT is one of the most versatile AI tools available to students. Learning how to formulate effective questions will help you get the most value from it:\n\nüîç Basic Question Techniques\n\n‚Ä¢ Be Specific\n  ‚ùå "Tell me about photosynthesis"\n  ‚úÖ "Explain the light-dependent reactions in photosynthesis for a first-year biology student"\n\n‚Ä¢ Provide Context\n  ‚ùå "Help me solve this equation: 3x + 7 = 22"\n  ‚úÖ "I\'m a 10th grade student learning to solve linear equations. Can you show me step-by-step how to solve 3x + 7 = 22?"\n\n‚Ä¢ Request Format Preferences\n  "Explain the causes of World War I in bullet points with key dates"\n\nüéØ Academic Use Cases\n\n‚Ä¢ Concept Explanation\n  "Explain the concept of moral hazard in economics using simple examples"\n\n‚Ä¢ Problem-Solving Help\n  "I\'m trying to balance this chemical equation: H2 + O2 ‚Üí H2O. Show me the steps."\n\n‚Ä¢ Essay Planning\n  "Help me create an outline for a 1000-word essay comparing Romeo and Juliet to West Side Story"\n\n‚Ä¢ Study Aid\n  "Create 10 practice questions about cellular respiration with answers"\n\nüí° Advanced Prompting Strategies\n\n‚Ä¢ Chain of Thought\n  "Walk through the process of calculating the derivative of f(x) = x¬≥ - 4x¬≤ + 5x - 2, explaining each step"\n\n‚Ä¢ Multiple Perspectives\n  "Explain the pros and cons of renewable energy from both environmental and economic perspectives"\n\n‚Ä¢ Simplification\n  "Explain quantum computing as if I\'m a high school student with basic physics knowledge"\n\n‚Ä¢ Error Checking\n  "Here\'s my solution to this calculus problem [your work]. Can you check if my approach is correct?"\n\n‚ö†Ô∏è Important Limitations\n\n‚Ä¢ ChatGPT may occasionally provide incorrect information\n‚Ä¢ It has limited knowledge of events after its training cutoff\n‚Ä¢ It can\'t access the internet for real-time information\n‚Ä¢ Always verify important facts with reliable sources\n\nWith practice, you\'ll develop the skill of crafting questions that get you the most helpful responses for your academic needs.'
        },
        {
          module_id: module3Data[0].id,
          title: 'Using Notion AI for Notes and Summaries',
          lesson_order: 2,
          content: 'Notion AI integrates powerful AI capabilities directly into the popular Notion workspace, making it an excellent tool for students to enhance their note-taking and summarization workflows:\n\nüìù Getting Started with Notion AI\n\n‚Ä¢ Access: Notion AI is a paid add-on ($10/month or included in certain team plans)\n‚Ä¢ Activation: Press `/AI` in any Notion block to access AI features\n‚Ä¢ Student discount: Notion offers educational pricing for verified students\n\nüî§ Key Features for Students\n\n‚Ä¢ Summarization\n  - Condense lengthy lecture notes into key points\n  - Example command: "/AI Summarize this into 5 main points"\n\n‚Ä¢ Explanation\n  - Clarify complex concepts in your notes\n  - Example command: "/AI Explain this concept in simpler terms"\n\n‚Ä¢ Format Conversion\n  - Transform bulleted lists into paragraphs (or vice versa)\n  - Example command: "/AI Convert these paragraphs into a bulleted list"\n\n‚Ä¢ Note Expansion\n  - Elaborate on brief notes with additional context\n  - Example command: "/AI Expand on these points with examples"\n\n‚Ä¢ Language Improvement\n  - Enhance writing clarity and fix grammar\n  - Example command: "/AI Improve the writing in this paragraph"\n\nüéì Academic Workflow Examples\n\n1. Lecture Notes Enhancement:\n   - Take rough notes during lecture\n   - Use Notion AI to organize and expand key points\n   - Request examples for difficult concepts\n\n2. Reading Summaries:\n   - Copy important passages from readings\n   - Use "/AI Summarize" to create concise versions\n   - Add your own insights alongside AI summaries\n\n3. Study Guide Creation:\n   - Compile notes from multiple sources\n   - Use "/AI Create study questions" to generate practice problems\n   - Request explanations for complex topics\n\nüí° Tips for Effective Use\n\n‚Ä¢ Always review AI-generated content for accuracy\n‚Ä¢ Combine AI summaries with your personal insights\n‚Ä¢ Use AI to format and structure information, not just generate it\n‚Ä¢ Create templates with AI commands for consistent note-taking\n‚Ä¢ Remember that Notion AI works best when refining existing content\n\nBy integrating Notion AI into your study routine, you can create more organized, comprehensive, and useful notes while saving significant time.'
        },
        {
          module_id: module3Data[0].id,
          title: 'Grammarly and Quillbot for Writing Help',
          lesson_order: 3,
          content: 'Grammarly and QuillBot are two powerful AI writing assistants that can significantly improve your academic writing. Each offers unique features that complement each other in the writing process:\n\n‚úçÔ∏è Grammarly: Your Writing Editor\n\nKey Features:\n\n‚Ä¢ Grammar & Spelling Checks\n  - Identifies and corrects basic writing errors\n  - Explains grammar rules when corrections are suggested\n\n‚Ä¢ Style Improvements\n  - Suggests more effective word choices\n  - Identifies awkward phrasing and wordiness\n\n‚Ä¢ Tone Detection\n  - Analyzes how your writing comes across (formal, friendly, etc.)\n  - Helps adjust to appropriate academic tone\n\n‚Ä¢ Plagiarism Detection (Premium)\n  - Compares text against web sources\n  - Essential for academic integrity\n\nBest For:\n- Real-time writing assistance\n- Final proofreading\n- Consistent writing style\n- Formal academic papers\n\nFree vs. Premium ($12-30/month):\n- Free: Basic grammar and spelling\n- Premium: Advanced suggestions, tone adjustments, plagiarism detection\n\nüîÑ QuillBot: Your Paraphrasing Assistant\n\nKey Features:\n\n‚Ä¢ Paraphrasing Tool\n  - Rewrites text while maintaining meaning\n  - Offers multiple paraphrasing styles (Standard, Fluency, Academic, etc.)\n  - Controls for synonym usage and sentence structure\n\n‚Ä¢ Summarizer\n  - Condenses long passages into key points\n  - Useful for literature reviews and research notes\n\n‚Ä¢ Grammar Checker\n  - Basic grammar and spelling corrections\n  - Less comprehensive than Grammarly\n\n‚Ä¢ Citation Generator\n  - Creates properly formatted citations\n\nBest For:\n- Paraphrasing complex material\n- Avoiding repetitive language\n- Summarizing research articles\n- Simplifying difficult concepts\n\nFree vs. Premium ($9.95/month):\n- Free: Limited paraphrasing (125 words), basic modes\n- Premium: Unlimited paraphrasing, all modes, compare versions\n\nüìö Effective Academic Workflow\n\n1. First Draft ‚Üí QuillBot\n   - When stuck on expressing complex ideas\n   - To simplify difficult source material\n\n2. Revision ‚Üí Grammarly\n   - Check for grammar and style issues\n   - Ensure appropriate academic tone\n\n3. Final Polish ‚Üí Both\n   - QuillBot for variety in language\n   - Grammarly for final error check\n\n‚ö†Ô∏è Ethical Considerations\n\n‚Ä¢ Always understand the content you submit\n‚Ä¢ Use tools to enhance your writing, not replace learning\n‚Ä¢ Check your institution\'s policies on AI writing assistance\n‚Ä¢ Never use paraphrasing to hide plagiarism\n\nWhen used responsibly, these tools can help you become a better writer by showing you improvements and alternatives you might not have considered on your own.'
        },
        {
          module_id: module3Data[0].id,
          title: 'AI Tools for Presentations & Design (Canva AI, Gamma)',
          lesson_order: 4,
          content: 'Creating professional-looking presentations and designs is now easier than ever with AI-powered tools. Let\'s explore how Canva AI and Gamma can transform your academic projects:\n\nüé® Canva AI: All-in-One Design Assistant\n\nKey Features:\n\n‚Ä¢ Magic Write\n  - Generates text for slides, posters, and social media\n  - Helps overcome writer\'s block for presentations\n  - Example prompt: "Write 3 bullet points about renewable energy benefits"\n\n‚Ä¢ Magic Design\n  - Converts text descriptions into complete designs\n  - Creates presentation templates based on your topic\n  - Example prompt: "Create a science project poster about ocean pollution"\n\n‚Ä¢ Background Remover & Image Generator\n  - Automatically removes backgrounds from images\n  - Creates custom images based on text descriptions\n\n‚Ä¢ Brand Kit\n  - Maintains consistent colors and fonts across projects\n  - Perfect for club presentations or consistent course work\n\nAccess:\n- Free tier includes limited AI features\n- Canva Pro (~$12.99/month) unlocks full AI capabilities\n- Educational discounts available for students\n\nüöÄ Gamma: AI-First Presentation Platform\n\nKey Features:\n\n‚Ä¢ Complete Presentation Generation\n  - Creates entire presentations from a simple topic or outline\n  - Includes content, structure, and visuals\n  - Example: "Create a 10-slide presentation on climate change solutions"\n\n‚Ä¢ Talking Slides\n  - AI presenter reads your slides with natural voice\n  - Helps with rehearsal and remote presentations\n\n‚Ä¢ Auto-formatting\n  - Automatically arranges content for visual appeal\n  - Maintains consistent design throughout\n\n‚Ä¢ Web-based Presentations\n  - Interactive formats beyond traditional slides\n  - Easy sharing via links\n\nAccess:\n- Free tier: Limited presentations and features\n- Pro plan ($8/month): Unlimited presentations and all features\n\nüìä Best Uses for Academic Work\n\n1. Class Presentations\n   - Generate initial slide structure and content\n   - Use AI to suggest visualizations of complex data\n   - Create professional-looking slides without design skills\n\n2. Research Posters\n   - Start with templates designed for academic posters\n   - Use AI to suggest layouts for research findings\n   - Generate appropriate visual metaphors for concepts\n\n3. Project Documentation\n   - Create visually consistent documentation\n   - Generate diagrams and flowcharts from descriptions\n   - Ensure professional appearance for submissions\n\nüí° Tips for Effective Use\n\n‚Ä¢ Always review AI-generated content for accuracy\n‚Ä¢ Customize generated designs to make them unique\n‚Ä¢ Use AI suggestions as starting points, not final products\n‚Ä¢ Combine text from research with AI-generated visuals\n‚Ä¢ Check your institution\'s policies on AI use for assignments\n\nBy leveraging these AI design tools, you can create polished, professional presentations in a fraction of the time, allowing you to focus more on your content and delivery.'
        }
      ]);

    // Module 4: Smart Practices and Ethics
    const { data: module4Data, error: module4Error } = await supabase
      .from('course_modules')
      .insert({
        course_id: courseId,
        title: 'Smart Practices and Ethics',
        description: 'Understanding the ethical considerations and best practices when using AI tools',
        module_order: 4,
        content: 'This module covers the ethical aspects of using AI tools in academic and professional settings, including avoiding plagiarism and maintaining academic integrity.'
      })
      .select();

    if (module4Error) throw module4Error;
    
    await supabase
      .from('lessons')
      .insert([
        {
          module_id: module4Data[0].id,
          title: 'What NOT to do with AI (Plagiarism, Cheating)',
          lesson_order: 1,
          content: 'As AI tools become increasingly sophisticated, it\'s critical to understand where the ethical boundaries lie, particularly in academic settings:\n\nüö´ Academic Violations to Avoid\n\n‚Ä¢ Direct Submission of AI-Generated Work\n  - Submitting an essay entirely written by ChatGPT\n  - Turning in code generated by GitHub Copilot without modification or understanding\n  - Presenting AI-created art or designs as your own original work\n\n‚Ä¢ Circumventing Learning Processes\n  - Using AI to solve problem sets without understanding the solutions\n  - Generating answers for online quizzes or tests\n  - Having AI complete coding assignments without learning the concepts\n\n‚Ä¢ Misrepresentation\n  - Claiming AI-assisted work was done without assistance\n  - Not disclosing the use of AI tools when required by instructors\n  - Using AI to create fake references or research that doesn\'t exist\n\n‚öñÔ∏è Potential Consequences\n\n‚Ä¢ Academic Penalties\n  - Course failure\n  - Academic probation\n  - Permanent record notations\n  - In severe cases, expulsion\n\n‚Ä¢ Professional Impact\n  - Skill deficiencies from missed learning opportunities\n  - Inability to apply concepts in real-world situations\n  - Potential credibility issues in future work\n\n‚Ä¢ Detection Risk\n  - Many institutions now use AI detection tools\n  - Professors are becoming skilled at spotting AI-generated work\n  - Some AI tools watermark their output\n\nüîç How AI Misuse Is Detected\n\n‚Ä¢ AI Detection Software\n  - Tools like Turnitin and GPTZero analyze writing patterns\n  - Can identify text likely generated by common AI models\n\n‚Ä¢ Instructor Verification\n  - Comparing work to student\'s previous writing style\n  - In-class assessments to verify understanding\n  - Oral examinations about submitted work\n\n‚Ä¢ Technical Indicators\n  - Unusual formatting or metadata\n  - Inconsistent knowledge levels within the same document\n  - Generic responses to specific prompts\n\nRemember: The purpose of education is to develop your skills and understanding. Using AI to bypass learning ultimately harms your own development and future prospects. AI should enhance your capabilities, not replace your intellectual growth.'
        },
        {
          module_id: module4Data[0].id,
          title: 'Academic Integrity and Smart Use',
          lesson_order: 2,
          content: 'Using AI tools ethically in academic settings requires understanding how to integrate them into your learning process while maintaining integrity. Here\'s how to use AI responsibly:\n\n‚úÖ Ethical AI Use in Academics\n\n‚Ä¢ Transparent Disclosure\n  - Check your institution\'s AI policy\n  - When in doubt, ask instructors about acceptable AI use\n  - Note AI assistance in your work when appropriate\n\n‚Ä¢ Learning-Focused Approach\n  - Use AI to understand concepts, not bypass learning\n  - Ask AI to explain solutions, not just provide answers\n  - Use explanations to develop your own understanding\n\n‚Ä¢ Appropriate Attribution\n  - Cite AI tools when used for content generation\n  - Example citation: "The initial draft was developed with assistance from [AI Tool], with subsequent substantial revisions and additions by the author."\n\nüß† Smart AI Integration Strategies\n\n1. Research Enhancement\n   ‚úì Use AI to summarize research papers to identify relevant sources\n   ‚úì Generate research questions and hypotheses to explore\n   ‚úì Analyze patterns in your collected data\n   ‚úó Don\'t fabricate research findings or sources\n\n2. Writing Process\n   ‚úì Brainstorm ideas and create outlines\n   ‚úì Get feedback on structure and clarity\n   ‚úì Improve language and grammar\n   ‚úó Don\'t submit AI-written essays as your own work\n\n3. Problem-Solving\n   ‚úì Check your work after you\'ve attempted solutions\n   ‚úì Get step-by-step explanations to understand methods\n   ‚úì Generate practice problems to build skills\n   ‚úó Don\'t copy solutions without understanding them\n\n4. Creative Projects\n   ‚úì Generate inspiration and ideas\n   ‚úì Refine and improve your original concepts\n   ‚úì Learn techniques and approaches\n   ‚úó Don\'t present AI-generated creative work as entirely your own\n\nüìã Practical Workflow Example\n\n1. Assignment Analysis\n   - Read and understand requirements yourself first\n   - Clarify concepts using AI if needed\n\n2. Initial Work\n   - Create your own first draft/solution\n   - Develop your ideas independently\n\n3. AI Assistance\n   - Use AI to review your work\n   - Request improvement suggestions\n   - Ask for explanations of difficult concepts\n\n4. Final Product\n   - Revise based on AI feedback\n   - Ensure you understand everything in your submission\n   - Add appropriate attribution if required\n\nBy following these guidelines, you\'ll gain the benefits of AI assistance while maintaining academic integrity and maximizing your learning experience.'
        },
        {
          module_id: module4Data[0].id,
          title: 'Staying Updated with AI Trends',
          lesson_order: 3,
          content: 'The AI landscape is evolving rapidly, with new tools and capabilities emerging constantly. Staying informed about these developments can give you an advantage in your studies and future career:\n\nüîÑ Why Staying Updated Matters\n\n‚Ä¢ Competitive Advantage\n  - Early adopters of new AI tools often gain significant advantages\n  - Understanding emerging capabilities helps you select the right tools\n\n‚Ä¢ Avoiding Obsolescence\n  - Tools and techniques can quickly become outdated\n  - Regular updates prevent reliance on inferior methods\n\n‚Ä¢ Career Readiness\n  - AI literacy is increasingly valuable in the job market\n  - Familiarity with AI trends signals forward-thinking to employers\n\nüì± Essential Resources for Staying Current\n\n‚Ä¢ News and Information Sources\n  - [The Gradient](https://thegradient.pub/) - Student-friendly AI research summaries\n  - [Towards Data Science](https://towardsdatascience.com/) - Practical AI applications\n  - [AI Weirdness](https://aiweirdness.com/) - Fun, accessible AI experiments\n  - [The Algorithm](https://www.technologyreview.com/topic/artificial-intelligence/) - MIT Technology Review\'s AI newsletter\n\n‚Ä¢ Social Media Channels\n  - Twitter: Follow #AItools #MachineLearning hashtags\n  - YouTube: Channels like "Two Minute Papers" and "AI Explained"\n  - Reddit: r/artificial, r/MachineLearning communities\n\n‚Ä¢ Podcasts\n  - "Lex Fridman Podcast" - Interviews with AI researchers\n  - "Practical AI" - Applied AI discussions\n  - "AI in Education" - Specific to academic applications\n\nüéì Academic Integration Methods\n\n1. Regular Exploration Time\n   - Schedule 30 minutes weekly to explore a new AI tool\n   - Test each tool with a real academic task\n\n2. Peer Learning\n   - Create a study group focused on AI tools\n   - Share discoveries and tips with classmates\n\n3. Educational Subscriptions\n   - Follow key AI developers and educational platforms\n   - Sign up for newsletters from OpenAI, Google AI, etc.\n\n4. Practical Application\n   - Apply new tools to actual coursework\n   - Document effectiveness for different tasks\n\nüë®‚Äçüè´ Faculty Engagement\n\n‚Ä¢ Share discoveries with receptive professors\n‚Ä¢ Ask about integrating AI tools into coursework\n‚Ä¢ Propose projects that responsibly incorporate AI\n\nüöÄ Future-Proofing Your Skills\n\n‚Ä¢ Focus on developing complementary skills that AI can\'t replace\n‚Ä¢ Learn to write effective prompts (prompt engineering)\n‚Ä¢ Practice critical evaluation of AI-generated content\n‚Ä¢ Understand both the capabilities and limitations of AI systems\n\nBy actively monitoring AI developments and thoughtfully integrating new tools into your academic workflow, you\'ll develop valuable meta-skills that extend beyond any specific technology or platform.'
        }
      ]);

    return { success: true, courseId };
  } catch (error) {
    console.error('Error setting up AI Tools course:', error);
    return { success: false, error };
  }
};

/**
 * Auto-generate content for "Introduction to Stock Investment" course
 */
const setupStockInvestmentCourse = async () => {
  try {
    // Create course
    const { data: courseData, error: courseError } = await supabase
      .from('courses')
      .insert({
        title: 'Introduction to Stock Investment',
        description: 'Learn the fundamentals of stock investing with this beginner-friendly course designed for Indian students.',
        price: 1000,
        referral_reward: 500
      })
      .select();

    if (courseError) throw courseError;
    if (!courseData || courseData.length === 0) throw new Error("Failed to create course");

    const courseId = courseData[0].id;

    // Module 1: Basics of Investing
    const { data: module1Data, error: module1Error } = await supabase
      .from('course_modules')
      .insert({
        course_id: courseId,
        title: 'Basics of Investing',
        description: 'Understand the fundamental concepts of investing in the stock market',
        module_order: 1,
        content: 'This module introduces you to the basic principles of stock investing and why it\'s important for building wealth.'
      })
      .select();

    if (module1Error) throw module1Error;
    
    await supabase
      .from('lessons')
      .insert([
        {
          module_id: module1Data[0].id,
          title: 'What is Stock Investing?',
          lesson_order: 1,
          content: 'Stock investing is the process of buying ownership shares in companies with the expectation that they will increase in value over time or provide income through dividends.\n\nüîë Key Concepts:\n\n‚Ä¢ Stocks (or Shares)\n  - Represent partial ownership in a company\n  - When you buy a stock, you become a shareholder\n  - Example: Owning 10 shares of Reliance means you own a tiny fraction of Reliance Industries\n\n‚Ä¢ Stock Market\n  - A marketplace where stocks are bought and sold\n  - Functions like an auction where prices are determined by supply and demand\n  - In India, the main stock exchanges are the National Stock Exchange (NSE) and Bombay Stock Exchange (BSE)\n\n‚Ä¢ Stock Price\n  - The current trading value of one share\n  - Constantly changes based on market sentiment and company performance\n  - Example: If Tata Motors trades at ‚Çπ500, that\'s the price for one share\n\n‚Ä¢ Returns on Investment\n  Two primary ways stocks generate returns:\n  1. Capital Appreciation: Price increases over time (buy at ‚Çπ100, sell at ‚Çπ150)\n  2. Dividends: Regular payments from company profits to shareholders\n\n‚Ä¢ Market Capitalization\n  - Total value of a company (share price √ó number of outstanding shares)\n  - Categories: Large-cap (stable), Mid-cap (growth potential), Small-cap (higher risk/reward)\n\nüíº Practical Application:\n\nImagine you buy 10 shares of HDFC Bank at ‚Çπ1,500 per share (‚Çπ15,000 investment):\n\n‚Ä¢ If the price rises to ‚Çπ1,650 in six months, your shares are now worth ‚Çπ16,500\n‚Ä¢ You\'ve gained ‚Çπ1,500 (10% return) in capital appreciation\n‚Ä¢ If HDFC pays a dividend of ‚Çπ15 per share, you\'ll also receive ‚Çπ150 in dividend income\n\nStock investing differs from other investments like fixed deposits or gold because you\'re actually owning a piece of a business, with your returns tied to that company\'s performance and growth.'
        },
        {
          module_id: module1Data[0].id,
          title: 'Why People Invest (Wealth, Goals)',
          lesson_order: 2,
          content: 'People invest in the stock market for various reasons, all tied to achieving financial goals and building wealth over time.\n\nüí∞ Primary Motivations for Investing\n\n‚Ä¢ Wealth Creation\n  - Stocks historically outperform most other asset classes over long periods\n  - Example: ‚Çπ10,000 invested in quality Indian stocks in 2010 could be worth over ‚Çπ45,000 by 2023\n  - The power of compounding means returns generate their own returns over time\n\n‚Ä¢ Beating Inflation\n  - Inflation reduces purchasing power of money (what ‚Çπ100 buys today vs. 5 years ago)\n  - While bank FDs might offer 5-6%, inflation often runs at similar levels\n  - Stocks have historically provided returns that exceed inflation rates\n\n‚Ä¢ Financial Independence\n  - Building a portfolio that generates passive income\n  - Creating assets that work for you without active effort\n  - Reducing dependence on salary as sole income source\n\n‚Ä¢ Specific Financial Goals\n  - Education funding: Investing for children\'s higher education\n  - Retirement planning: Building a corpus for post-retirement needs\n  - Major purchases: Saving for house down payment or starting a business\n\n‚Ä¢ Tax Benefits\n  - Equity-Linked Savings Schemes (ELSS) offer tax deductions under Section 80C\n  - Long-term capital gains have favorable tax treatment compared to other income\n\nüìä Statistical Perspective\n\nHistorical data from the Indian market shows:\n\n‚Ä¢ Nifty 50 has delivered approximately 12-15% average annual returns over long periods\n‚Ä¢ Fixed deposits typically yield 5-7% (often barely keeping pace with inflation)\n‚Ä¢ Real estate typically appreciates at 7-10% annually in major Indian cities\n\nüéØ Examples of Goal-Based Investing\n\n1. Short-Term Goals (1-3 years)\n   - Wedding expenses\n   - Vehicle purchase\n   - Emergency fund\n\n2. Medium-Term Goals (3-7 years)\n   - House down payment\n   - Higher education funding\n   - Starting a business\n\n3. Long-Term Goals (7+ years)\n   - Retirement planning\n   - Children\'s education\n   - Financial independence\n\nUnderstanding your personal "why" for investing is crucial as it determines your investment strategy, risk tolerance, and time horizon. Your goals act as motivational anchors during market volatility and help you stay focused on the long-term benefits rather than short-term fluctuations.'
        },
        {
          module_id: module1Data[0].id,
          title: 'Common Terms (Stock, Bond, Mutual Fund)',
          lesson_order: 3,
          content: 'Understanding the basic terminology of investing is essential for making informed decisions. Here\'s a breakdown of the most important terms every beginning investor should know:\n\nüìà Stock Market Basics\n\n‚Ä¢ Stock/Share\n  - Represents ownership in a company\n  - Provides voting rights at shareholder meetings\n  - No guaranteed returns, but potential for highest growth\n  - Example: One share of TCS represents partial ownership of Tata Consultancy Services\n\n‚Ä¢ Bond\n  - A loan you make to a company or government\n  - Pays fixed interest over a specified period\n  - Returns principal amount at maturity\n  - Generally safer than stocks but with lower returns\n  - Example: Government of India bonds or corporate bonds from companies like HDFC\n\n‚Ä¢ Mutual Fund\n  - A pool of money from many investors managed by professionals\n  - Invests in a diversified portfolio of stocks, bonds, or other securities\n  - Types: Equity funds, debt funds, hybrid funds, index funds, etc.\n  - Example: SBI Bluechip Fund or HDFC Mid-Cap Opportunities Fund\n\n‚Ä¢ Index\n  - A measurement of a section of the stock market\n  - Commonly used as benchmarks for performance\n  - Examples: Nifty 50 (top 50 companies on NSE), Sensex (top 30 companies on BSE)\n\nüíº Investment Vehicles\n\n‚Ä¢ ETF (Exchange Traded Fund)\n  - Similar to mutual funds but trades like a stock on exchanges\n  - Generally has lower expense ratios than mutual funds\n  - Example: Nippon India ETF Nifty BeES\n\n‚Ä¢ SIP (Systematic Investment Plan)\n  - Method of investing fixed amounts regularly in mutual funds\n  - Helps average purchase costs over time\n  - Example: Investing ‚Çπ5,000 monthly in an equity mutual fund\n\n‚Ä¢ IPO (Initial Public Offering)\n  - When a private company first offers shares to the public\n  - Opportunity to invest in companies at their early public stage\n  - Example: Zomato\'s IPO in 2021\n\nüìä Performance Metrics\n\n‚Ä¢ Dividend\n  - Portion of company profits paid to shareholders\n  - Usually expressed as dividend per share or dividend yield (%)\n  - Example: If TCS declares ‚Çπ8 dividend per share and the share price is ‚Çπ3,200, the dividend yield is 0.25%\n\n‚Ä¢ P/E Ratio (Price-to-Earnings)\n  - Stock price divided by earnings per share\n  - Indicates how expensive a stock is relative to its earnings\n  - Lower P/E might indicate undervaluation, higher P/E potential overvaluation or high growth expectations\n  - Example: If a stock trades at ‚Çπ500 and earns ‚Çπ20 per share, its P/E ratio is 25\n\n‚Ä¢ Market Capitalization\n  - Total value of all outstanding shares (share price √ó number of shares)\n  - Categories: Large-cap (>‚Çπ20,000 crore), Mid-cap (‚Çπ5,000-20,000 crore), Small-cap (<‚Çπ5,000 crore)\n  - Example: If a company has 1 crore shares outstanding at ‚Çπ500 each, its market cap is ‚Çπ500 crore\n\n‚Ä¢ Bull Market vs. Bear Market\n  - Bull market: Prolonged period of rising stock prices (optimistic)\n  - Bear market: Prolonged period of falling stock prices (pessimistic)\n\nFamiliarizing yourself with these terms will help you understand investment discussions, research, and make more confident decisions as you begin your investing journey.'
        },
        {
          module_id: module1Data[0].id,
          title: 'Risk and Return Simplified',
          lesson_order: 4,
          content: 'Understanding the relationship between risk and return is fundamental to successful investing. This concept helps you set realistic expectations and make appropriate investment choices:\n\n‚öñÔ∏è The Risk-Return Tradeoff\n\nThe basic principle: Higher potential returns typically come with higher risk\n\n‚Ä¢ Low Risk, Low Return\n  - Examples: Bank FDs, government bonds, liquid funds\n  - Typical returns: 3-7% annually\n  - Safety features: Guaranteed returns, often with insurance/government backing\n  - Best for: Emergency funds, short-term goals, capital preservation\n\n‚Ä¢ Medium Risk, Medium Return\n  - Examples: Corporate bonds, balanced mutual funds, blue-chip stocks\n  - Typical returns: 8-12% annually\n  - Safety features: Established companies, diversification\n  - Best for: Medium-term goals (3-7 years)\n\n‚Ä¢ High Risk, High Return\n  - Examples: Small-cap stocks, sector-specific funds, international stocks\n  - Potential returns: 12%+ annually (but with significant variation)\n  - Risk factors: Higher volatility, less predictable outcomes\n  - Best for: Long-term goals (7+ years) with time to recover from downturns\n\nüìä Risk Visualization\n\nImagine two investment paths over 10 years:\n\n1. Fixed Deposit (Low Risk)\n   - Year 1: +6%\n   - Year 2: +6%\n   - Year 3: +6%\n   - And so on, with minimal variation\n   - Final result: Approximately 79% total return over 10 years\n\n2. Equity Investment (Higher Risk)\n   - Year 1: +20%\n   - Year 2: -8%\n   - Year 3: +15%\n   - Year 4: +25%\n   - Year 5: -12%\n   - And so on, with significant ups and downs\n   - Final result: Potentially 150-200% total return over 10 years\n\nüõ°Ô∏è Risk Management Strategies\n\n‚Ä¢ Diversification\n  - "Don\'t put all eggs in one basket"\n  - Spread investments across different companies, sectors, and asset classes\n  - Example: Instead of investing ‚Çπ50,000 in one stock, invest ‚Çπ10,000 each in 5 different companies\n\n‚Ä¢ Time Horizon\n  - Longer investment periods help smooth out market volatility\n  - Historically, the risk of negative returns decreases significantly over longer holding periods\n  - Example: Nifty 50 has never given negative returns over any 10-year rolling period\n\n‚Ä¢ Systematic Investing\n  - Regular investments regardless of market conditions (SIPs)\n  - Reduces impact of market timing and averages purchase costs\n  - Example: Investing ‚Çπ5,000 monthly instead of ‚Çπ60,000 once a year\n\n‚Ä¢ Asset Allocation\n  - Distributing investments across asset classes based on risk tolerance\n  - Adjusting allocation as goals and time horizons change\n  - Example: A young investor might have 80% in stocks and 20% in bonds; a retiree might have 40% in stocks and 60% in bonds\n\nüß† Understanding Your Risk Tolerance\n\nRisk tolerance depends on:\n\n‚Ä¢ Age and Time Horizon: Younger investors can generally take more risk\n‚Ä¢ Financial Situation: Emergency funds and stable income provide safety nets\n‚Ä¢ Emotional Comfort: Some people can\'t sleep at night during market downturns\n‚Ä¢ Financial Goals: Different goals require different risk levels\n\nBy understanding the risk-return relationship and your own risk tolerance, you can create an investment strategy that balances potential growth with your comfort level and financial needs.'
        }
      ]);

    // Module 2: Stock Market Structure
    const { data: module2Data, error: module2Error } = await supabase
      .from('course_modules')
      .insert({
        course_id: courseId,
        title: 'Stock Market Structure',
        description: 'Learn about how stock markets work, including exchanges and regulatory bodies',
        module_order: 2,
        content: 'This module explains the structure of stock markets, focusing on Indian exchanges and how they\'re regulated.'
      })
      .select();

    if (module2Error) throw module2Error;
    
    await supabase
      .from('lessons')
      .insert([
        {
          module_id: module2Data[0].id,
          title: 'How the Stock Market Works',
          lesson_order: 1,
          content: 'The stock market functions as a sophisticated marketplace where buyers and sellers trade shares of publicly listed companies. Understanding its mechanics helps you navigate investing with confidence.\n\nüèõÔ∏è Basic Market Structure\n\n‚Ä¢ Primary Market\n  - Where new securities are issued and sold for the first time\n  - Companies raise capital through Initial Public Offerings (IPOs)\n  - Investors buy directly from the issuing company\n  - Example: When Zomato went public in 2021, investors bought shares directly from the company\n\n‚Ä¢ Secondary Market\n  - Where previously issued securities are traded between investors\n  - Companies don\'t receive funds from these transactions\n  - Most daily trading occurs here\n  - Example: Buying Reliance shares from another investor through your broker\n\n‚öôÔ∏è Trading Mechanics\n\n‚Ä¢ Order Matching\n  - Stock exchanges use order matching systems\n  - Buy orders matched with sell orders at mutually acceptable prices\n  - Orders executed when price conditions align\n\n‚Ä¢ Order Types\n  1. Market Order: Buy/sell immediately at current market price\n  2. Limit Order: Buy/sell only at specified price or better\n  3. Stop Loss Order: Triggers a market sell when price falls to specified level\n\n‚Ä¢ Trading Sessions\n  - Regular trading hours: 9:15 AM to 3:30 PM (Indian markets)\n  - Pre-market session: 9:00 AM to 9:15 AM\n  - After-hours trading: Limited options in India\n\nüì± Market Participants\n\n‚Ä¢ Retail Investors\n  - Individual investors like you and me\n  - Typically trade smaller volumes\n  - Growing segment in India with over 80 million demat accounts\n\n‚Ä¢ Institutional Investors\n  - Mutual funds, insurance companies, pension funds\n  - Trade large volumes and influence market movements\n  - Example: SBI Mutual Fund, LIC, HDFC AMC\n\n‚Ä¢ Foreign Institutional Investors (FIIs)\n  - International entities investing in Indian markets\n  - Their investment flows can significantly impact market direction\n\n‚Ä¢ Market Makers\n  - Provide liquidity by constantly offering to buy and sell securities\n  - Help ensure smooth trading and price discovery\n\n‚Ä¢ Brokers\n  - Act as intermediaries between investors and exchanges\n  - Execute trades on behalf of clients\n  - Examples: Zerodha, Upstox, Groww\n\nüìà Price Determination\n\n‚Ä¢ Supply and Demand\n  - Stock prices move based on buying and selling pressure\n  - More buyers than sellers = price rises\n  - More sellers than buyers = price falls\n\n‚Ä¢ Influencing Factors\n  - Company performance (earnings, growth prospects)\n  - Industry trends and competitive position\n  - Macroeconomic conditions (interest rates, inflation)\n  - Market sentiment and investor psychology\n\nüîÑ Market Indices\n\n‚Ä¢ Purpose of Indices\n  - Represent market or segment performance\n  - Serve as benchmarks for investment performance\n  - Track overall market trends\n\n‚Ä¢ Major Indian Indices\n  - Nifty 50: Represents 50 largest companies on NSE\n  - Sensex: Tracks 30 largest and most liquid stocks on BSE\n  - Nifty Bank, Nifty IT, etc.: Sector-specific indices\n\nUnderstanding these basic mechanics helps you participate in the market more effectively and makes the investing process less mysterious. Remember that markets ultimately reflect the collective decisions of all participants reacting to information and opportunities.'
        },
        {
          module_id: module2Data[0].id,
          title: 'Indian Stock Exchanges (NSE, BSE)',
          lesson_order: 2,
          content: 'India has two major stock exchanges that form the backbone of its capital markets: the National Stock Exchange (NSE) and the Bombay Stock Exchange (BSE). Understanding their roles and differences is important for any Indian investor.\n\nüè¢ National Stock Exchange (NSE)\n\n‚Ä¢ Establishment: Founded in 1992 as the first electronic exchange in India\n\n‚Ä¢ Size and Volume:\n  - Largest stock exchange in India by trading volume\n  - Among the top 10 largest stock exchanges globally\n  - Average daily trading volume: ‚Çπ60,000+ crore\n\n‚Ä¢ Key Characteristics:\n  - Fully electronic trading platform from inception\n  - More liquid for most stocks, especially derivatives\n  - Preferred by institutional investors and active traders\n  - Lower impact cost for large trades\n\n‚Ä¢ Flagship Index: Nifty 50\n  - Represents the weighted average of 50 largest and most liquid Indian companies\n  - Base value of 1000 (November 1995)\n  - Rebalanced semi-annually\n\n‚Ä¢ Other Important NSE Indices:\n  - Nifty Bank (banking sector stocks)\n  - Nifty IT (information technology companies)\n  - Nifty Next 50 (the next 50 largest companies after Nifty 50)\n\nüèõÔ∏è Bombay Stock Exchange (BSE)\n\n‚Ä¢ Establishment: Founded in 1875, Asia\'s oldest stock exchange and the world\'s 10th oldest\n\n‚Ä¢ Size and Volume:\n  - Largest exchange by number of listed companies (5,000+)\n  - Lower trading volumes compared to NSE\n  - Average daily trading volume: ‚Çπ5,000-7,000 crore\n\n‚Ä¢ Key Characteristics:\n  - Historical significance and legacy\n  - Better for certain small and mid-cap stocks\n  - Often first choice for new listings/IPOs\n  - Transitioned from open outcry to electronic trading in 1995\n\n‚Ä¢ Flagship Index: S&P BSE SENSEX (Sensitive Index)\n  - Tracks 30 large, well-established and financially sound companies\n  - Base value of 100 (1978-79)\n  - One of the most tracked Indian market indicators\n\n‚Ä¢ Other Important BSE Indices:\n  - BSE SmallCap\n  - BSE MidCap\n  - BSE 500 (broader market index)\n\nüîÑ Differences Between NSE and BSE\n\n‚Ä¢ Trading Platform:\n  - NSE: NEAT (National Exchange for Automated Trading)\n  - BSE: BOLT (BSE On-Line Trading)\n\n‚Ä¢ Market Hours:\n  - Both operate from 9:15 AM to 3:30 PM, Monday to Friday\n  - Pre-opening session: 9:00 AM to 9:15 AM\n\n‚Ä¢ Circuit Limits:\n  - Both employ circuit breakers to prevent extreme volatility\n  - Limits of 2%, 5%, 10%, or 20% depending on stock category\n\n‚Ä¢ Settlement Cycle:\n  - Both follow T+2 rolling settlement (trades settled two working days after execution)\n  - Moving toward T+1 settlement (one day) in phases\n\nüíº Practical Implications for Investors\n\n‚Ä¢ Price Differences\n  - Same stocks may trade at slightly different prices on NSE vs. BSE\n  - Arbitrage opportunities are rare due to algorithmic trading\n\n‚Ä¢ Choice of Exchange\n  - For most retail investors, the exchange matters little as brokers offer access to both\n  - NSE typically offers better liquidity and tighter spreads for most stocks\n  - Some small-caps may be more liquid on BSE\n\n‚Ä¢ Tracking Performance\n  - When comparing your returns against benchmarks, ensure you\'re using the appropriate index\n  - Nifty 50 and Sensex often move similarly but aren\'t identical\n\nAs a beginning investor, you\'ll likely have access to both exchanges through your broker. The choice of which exchange to use for a particular trade is often handled automatically to get you the best execution price.'
        },
        {
          module_id: module2Data[0].id,
          title: 'Role of SEBI (India\'s Market Regulator)',
          lesson_order: 3,
          content: 'The Securities and Exchange Board of India (SEBI) plays a crucial role in ensuring that India\'s financial markets operate fairly and efficiently. Understanding SEBI\'s functions helps investors appreciate the protections available to them.\n\nüõ°Ô∏è What is SEBI?\n\n‚Ä¢ Establishment\n  - Founded in 1988 as a non-statutory body\n  - Given statutory powers in 1992 through the SEBI Act\n  - Headquartered in Mumbai (BKC), with regional offices across India\n\n‚Ä¢ Primary Objectives\n  - Protect investor interests\n  - Promote market development\n  - Regulate securities markets\n  - Ensure fair, efficient, and transparent markets\n\nüîç Key Functions of SEBI\n\n‚Ä¢ Registration and Regulation\n  - Registers and regulates market intermediaries (brokers, mutual funds, FIIs, etc.)\n  - Sets operational standards and codes of conduct\n  - Example: Mandating brokers to maintain minimum net worth requirements\n\n‚Ä¢ Investor Protection\n  - Monitors unfair trading practices\n  - Educates investors through awareness programs\n  - Provides grievance redressal mechanisms\n  - Example: SCORES platform for investor complaints\n\n‚Ä¢ Market Surveillance\n  - Monitors trading activities to detect market manipulation\n  - Investigates suspicious transactions\n  - Takes action against violations\n  - Example: Tracking unusual price movements or trading volumes\n\n‚Ä¢ Disclosure Requirements\n  - Ensures companies provide timely and accurate information\n  - Mandates regular financial reporting\n  - Requires immediate disclosure of material events\n  - Example: Quarterly results, merger announcements\n\n‚Ä¢ Anti-Fraud Measures\n  - Prohibits insider trading and market manipulation\n  - Imposes penalties for fraudulent activities\n  - Example: Penalties for spreading false information to influence stock prices\n\nüìã Major SEBI Regulations Affecting Retail Investors\n\n‚Ä¢ IPO Regulations\n  - Guidelines for companies going public\n  - Disclosure requirements in offer documents\n  - Pricing norms and allocation policies\n  - Example: Minimum public shareholding requirements\n\n‚Ä¢ Mutual Fund Regulations\n  - Framework for mutual fund operations\n  - Expense ratio limits\n  - Risk classification and disclosure norms\n  - Example: Categorization of schemes as equity, debt, hybrid, etc.\n\n‚Ä¢ Insider Trading Prohibition\n  - Prevents trading based on unpublished price-sensitive information\n  - Requires disclosures by insiders\n  - Example: Directors must disclose their trades in company shares\n\n‚Ä¢ Takeover Code\n  - Rules for acquiring substantial shares or control\n  - Mandates open offers to protect minority shareholders\n  - Example: Acquiring 25%+ shares triggers mandatory open offer\n\nüõ†Ô∏è Investor Protection Mechanisms\n\n‚Ä¢ SCORES (SEBI Complaints Redress System)\n  - Online platform for filing and tracking investor complaints\n  - Ensures timely resolution by market intermediaries\n\n‚Ä¢ Investor Education\n  - Conducts workshops and awareness programs\n  - Publishes educational materials\n  - Example: SEBI\'s "Investor Education" portal\n\n‚Ä¢ Investor Protection Funds\n  - Compensates investors in case of broker defaults\n  - Maintained by stock exchanges under SEBI supervision\n\n‚öñÔ∏è Recent SEBI Reforms\n\n‚Ä¢ T+1 Settlement Cycle\n  - Reducing settlement time from T+2 to T+1 days\n  - Makes funds/securities available faster\n\n‚Ä¢ Mutual Fund Categorization\n  - Standardized fund categories for better comparison\n  - Clearer investment mandates\n\n‚Ä¢ Enhanced Disclosure Requirements\n  - More transparent and detailed disclosures\n  - Risk-o-meter for better risk assessment\n\n‚Ä¢ Digital Gold Regulations\n  - Framework for investments in digital gold\n  - Consumer protection measures\n\nSEBI\'s regulations and oversight create a safer environment for retail investors. While sometimes perceived as restrictive, these rules ultimately protect your interests and help maintain market integrity. Always verify that you\'re dealing with SEBI-registered entities when investing.'
        },
        {
          module_id: module2Data[0].id,
          title: 'Types of Stocks (Large, Mid, Small Cap)',
          lesson_order: 4,
          content: 'Understanding stock market capitalization categories helps investors choose securities that align with their investment goals and risk tolerance. Let\'s explore the different types of stocks based on market capitalization:\n\nüí∞ Market Capitalization: The Basics\n\nMarket Cap = Share Price √ó Total Outstanding Shares\n\nExample: If a company has 1 crore shares trading at ‚Çπ500 each, its market cap is ‚Çπ500 crores.\n\nüîµ Large-Cap Stocks\n\n‚Ä¢ Definition in India\n  - Market capitalization above ‚Çπ20,000 crores\n  - Top 100 companies by market cap\n  - Examples: Reliance Industries, TCS, HDFC Bank, ITC, Infosys\n\n‚Ä¢ Characteristics\n  - Well-established businesses with proven track records\n  - Typically industry leaders or dominant players\n  - More transparent and better analyzed\n  - Generally stable earnings and often pay regular dividends\n  - High trading volumes and liquidity\n\n‚Ä¢ Advantages\n  - Lower volatility and risk\n  - Better resilience during market downturns\n  - Regular dividend income in many cases\n  - Easier to buy/sell large quantities without price impact\n\n‚Ä¢ Disadvantages\n  - Generally lower growth potential\n  - May underperform in strong bull markets\n\n‚Ä¢ Ideal for: Conservative investors, retirees, or those seeking stability\n\nüü¢ Mid-Cap Stocks\n\n‚Ä¢ Definition in India\n  - Market capitalization between ‚Çπ5,000-20,000 crores\n  - Companies ranked 101-250 by market cap\n  - Examples: Federal Bank, Apollo Hospitals, Jubilant FoodWorks\n\n‚Ä¢ Characteristics\n  - Established businesses in growth phase\n  - Often operate in expanding market segments\n  - Moderate analyst coverage\n  - Balance of growth and stability\n  - Reasonable liquidity\n\n‚Ä¢ Advantages\n  - Better growth potential than large-caps\n  - Possibility of becoming future large-caps\n  - Often overlooked by institutional investors\n  - Usually more efficient than large-caps in operations\n\n‚Ä¢ Disadvantages\n  - Higher volatility than large-caps\n  - More susceptible to economic slowdowns\n  - Less information and research available\n\n‚Ä¢ Ideal for: Growth-oriented investors with moderate risk tolerance\n\nüü† Small-Cap Stocks\n\n‚Ä¢ Definition in India\n  - Market capitalization below ‚Çπ5,000 crores\n  - Companies ranked beyond 250 by market cap\n  - Examples: Welspun India, Dishman Carbogen, Precision Wires\n\n‚Ä¢ Characteristics\n  - Younger companies or those in niche segments\n  - Limited analyst coverage\n  - Often focused on specific products/services\n  - Lower trading volumes and liquidity\n  - Less information publicly available\n\n‚Ä¢ Advantages\n  - Highest growth potential\n  - Opportunity to invest in undiscovered gems\n  - Possibility of multibagger returns\n  - Less institutional ownership (less price manipulation)\n\n‚Ä¢ Disadvantages\n  - Highest volatility and risk\n  - Most affected during market downturns\n  - Liquidity challenges (harder to buy/sell large quantities)\n  - Limited disclosure and transparency\n\n‚Ä¢ Ideal for: Aggressive investors with high risk tolerance and long time horizons\n\nüìä Performance Comparison (Historical Trends)\n\n‚Ä¢ Returns (10-Year Average Annual)\n  - Large-caps: 12-14%\n  - Mid-caps: 14-16%\n  - Small-caps: 16-18%\n  Note: These are approximate ranges and vary based on specific periods\n\n‚Ä¢ Volatility (Standard Deviation)\n  - Large-caps: Lowest\n  - Mid-caps: Moderate\n  - Small-caps: Highest\n\nüîÑ Market Cap Rotation\n\nDifferent market cap segments outperform at different times in market cycles:\n\n‚Ä¢ Early Economic Recovery: Small and mid-caps typically outperform\n‚Ä¢ Mature Bull Market: Performance tends to be more evenly distributed\n‚Ä¢ Market Corrections: Large-caps usually offer better downside protection\n‚Ä¢ Economic Uncertainty: Flight to quality favors large-caps\n\nüíº Building a Balanced Portfolio\n\nA well-diversified portfolio might include stocks across market caps:\n\n‚Ä¢ Conservative Portfolio: 70% Large-cap, 20% Mid-cap, 10% Small-cap\n‚Ä¢ Balanced Portfolio: 50% Large-cap, 30% Mid-cap, 20% Small-cap\n‚Ä¢ Aggressive Portfolio: 30% Large-cap, 40% Mid-cap, 30% Small-cap\n\nYounger investors with longer time horizons can typically afford to allocate more to mid and small-caps, while those nearing retirement might prefer the stability of large-caps.'
        }
      ]);

    // Module 3: How to Start Investing
    const { data: module3Data, error: module3Error } = await supabase
      .from('course_modules')
      .insert({
        course_id: courseId,
        title: 'How to Start Investing',
        description: 'Learn the practical steps to begin your investment journey in the stock market',
        module_order: 3,
        content: 'This module provides practical guidance on how to start investing, from choosing a broker to making your first investment.'
      })
      .select();

    if (module3Error) throw module3Error;
    
    await supabase
      .from('lessons')
      .insert([
        {
          module_id: module3Data[0].id,
          title: 'Choosing a Stock Broker (Zerodha, Groww)',
          lesson_order: 1,
          content: 'Selecting the right stock broker is a crucial first step in your investment journey. The broker you choose will impact your trading costs, platform experience, and available services.\n\nüîç Types of Brokers in India\n\n‚Ä¢ Full-Service Brokers\n  - Offer comprehensive services (trading, research, advisory, wealth management)\n  - Higher brokerage fees (typically percentage-based)\n  - Provide personalized guidance and recommendations\n  - Examples: ICICI Direct, HDFC Securities, Motilal Oswal\n\n‚Ä¢ Discount Brokers\n  - Focus on low-cost execution of trades\n  - Flat fee structure regardless of trade value\n  - Limited or no personalized advisory services\n  - Self-directed investing platform\n  - Examples: Zerodha, Upstox, Groww, Angel One\n\nüìã Key Factors to Consider When Choosing a Broker\n\n‚Ä¢ Brokerage Structure\n  - Trading costs significantly impact long-term returns\n  - Discount brokers: ‚Çπ0-20 per executed order\n  - Full-service brokers: 0.3-0.5% of trade value\n  - Example: Trading ‚Çπ50,000 might cost ‚Çπ20 with a discount broker vs. ‚Çπ250 with a full-service broker\n\n‚Ä¢ Platform Usability\n  - User-friendly interface, especially important for beginners\n  - Mobile app quality and features\n  - Ease of fund transfers and withdrawals\n\n‚Ä¢ Customer Service\n  - Responsiveness to queries and issues\n  - Availability of support channels (phone, email, chat)\n  - Quality of response to technical problems\n\n‚Ä¢ Additional Costs\n  - Account opening/maintenance fees\n  - AMC (Annual Maintenance Charges) for demat account\n  - Payment gateway charges\n  - Inactivity fees\n\n‚Ä¢ Trading Tools & Resources\n  - Charts and technical analysis tools\n  - Screeners for stock selection\n  - Research reports and market news\n  - Educational resources\n\n‚Ä¢ Security Features\n  - Two-factor authentication\n  - Insurance protection\n  - Regulatory compliance\n\nüîé Popular Broker Comparison\n\n‚Ä¢ Zerodha\n  - India\'s largest broker by active clients\n  - Pros: Pioneer in discount broking, robust trading platform (Kite), clean interface\n  - Cons: Limited research, no relationship manager\n  - Pricing: ‚Çπ0 for delivery, ‚Çπ20 per executed order for intraday/F&O\n  - Best for: Active traders who value platform reliability and clean UI\n\n‚Ä¢ Groww\n  - Newer entrant focused on millennial investors\n  - Pros: Extremely user-friendly for beginners, integrated mutual funds & stocks\n  - Cons: Less advanced trading features, newer to broking\n  - Pricing: ‚Çπ0 for delivery, ‚Çπ20 per executed order for intraday\n  - Best for: Absolute beginners and mutual fund investors\n\n‚Ä¢ Upstox\n  - Well-established discount broker\n  - Pros: Low costs, good mobile app, decent research\n  - Cons: Customer service can be improved\n  - Pricing: ‚Çπ0 for delivery, ‚Çπ20 per executed order for intraday/F&O\n  - Best for: Cost-conscious investors\n\n‚Ä¢ Angel One\n  - Transformed from traditional to discount broker\n  - Pros: Research support, SmartAPI for algo trading\n  - Cons: Platform can be overwhelming for beginners\n  - Pricing: ‚Çπ0 for delivery, ‚Çπ20 per executed order for intraday/F&O\n  - Best for: Investors seeking research with low costs\n\n‚Ä¢ ICICI Direct/HDFC Securities\n  - Full-service brokers with bank backing\n  - Pros: Comprehensive research, relationship manager, integrated banking\n  - Cons: Higher costs, sometimes complex platforms\n  - Pricing: Percentage-based, typically 0.3-0.5% of trade value\n  - Best for: Investors who need guidance and prefer bank-backed security\n\nüöÄ Getting Started\n\n1. Research and Compare\n   - Visit broker websites and review comparison sites\n   - Download mobile apps to test user experience\n   - Read user reviews on forums like r/IndianStreetBets\n\n2. Consider Your Needs\n   - Beginner needing guidance? Consider full-service or education-focused discount brokers\n   - Tech-savvy with market knowledge? Discount brokers offer significant savings\n   - Frequent trader? Prioritize low costs and platform stability\n   - Long-term investor? Account charges may matter more than per-trade fees\n\n3. Open a Trial Account\n   - Many brokers offer demo accounts\n   - Test the platform before committing\n\nFor most beginners today, discount brokers offer the best value, with platforms becoming increasingly user-friendly. If you\'re confident in making your own investment decisions, the cost savings are substantial over time.'
        },
        {
          module_id: module3Data[0].id,
          title: 'Opening a Demat Account (Step-by-step)',
          lesson_order: 2,
          content: 'A Demat (Dematerialized) account is essential for investing in the Indian stock market. It\'s a digital account where your securities (shares, bonds, mutual funds, etc.) are held in electronic form. Here\'s a comprehensive guide to opening a Demat account:\n\nüìã Prerequisites\n\n‚Ä¢ Basic Requirements\n  - Age: 18 years or above\n  - PAN Card (mandatory)\n  - Address proof (Aadhaar, Passport, Voter ID, Driving License)\n  - Mobile number linked with Aadhaar\n  - Email address\n  - Bank account in your name\n  - Recent passport-sized photograph\n  - Income proof (for trading in derivatives)\n\n‚Ä¢ Connected Accounts\n  - Trading Account: For executing buy/sell transactions\n  - Bank Account: For fund transfers\n\nNote: Most brokers offer a 3-in-1 account that links your demat, trading, and bank accounts together.\n\nüî¢ Step-by-Step Process\n\n1. Choose Your Depository Participant (DP)\n   - Usually your broker (Zerodha, Groww, ICICI Direct, etc.)\n   - DPs act as intermediaries between you and depositories (NSDL or CDSL)\n\n2. Complete the Online Application\n   - Visit the broker\'s website/app\n   - Click on "Open an Account" or similar option\n   - Fill in personal details (name, DOB, contact information)\n\n3. KYC Verification\n   - Upload scanned copies of required documents (PAN, Aadhaar)\n   - Most brokers now offer digital KYC via:\n     a) Aadhaar OTP verification\n     b) Video KYC process\n\n4. Sign the Agreement\n   - Review the DP-Client agreement\n   - Complete e-signing (usually via Aadhaar-based eSign)\n\n5. In-Person Verification (IPV)\n   - Can be done through:\n     a) Video KYC (most common now)\n     b) Biometric verification\n     c) Physical verification (rarely needed now)\n\n6. Payment of Fees\n   - Account opening fee (varies by broker, often waived by discount brokers)\n   - Annual maintenance charges (AMC)\n   - Pay online through payment gateway\n\n7. Complete the NACH/Mandate Setup\n   - Link your bank account for seamless fund transfers\n   - Authorize auto-debits for investments\n\n8. Receive Account Details\n   - Beneficial Owner ID (BO ID) for your Demat account\n   - Login credentials for trading platform\n\nüí∞ Understanding Demat Account Costs\n\n‚Ä¢ One-time Charges\n  - Account opening fee: ‚Çπ0-300 (often waived by discount brokers)\n\n‚Ä¢ Recurring Charges\n  - Annual Maintenance Charge (AMC): ‚Çπ0-750 per year\n  - Transaction fees: Charged when buying/selling securities\n  - DP Transaction charges: ‚Çπ13-35 per ISIN per transaction\n\n‚Ä¢ Other Potential Fees\n  - Demat issuance/redemption fees\n  - Failed instruction charges\n  - Statement request fees (physical)\n  - Corporate action charges\n\nüì± Popular Online Account Opening Options\n\n‚Ä¢ Zerodha\n  - Process time: 1-2 hours (paperless)\n  - AMC: ‚Çπ300+GST per year\n  - Unique feature: No minimum balance requirements\n\n‚Ä¢ Groww\n  - Process time: Usually same day\n  - AMC: ‚Çπ200+GST per year\n  - Unique feature: Easy mutual fund integration\n\n‚Ä¢ Upstox\n  - Process time: 1-2 days\n  - AMC: ‚Çπ300+GST per year (sometimes promotional offers)\n  - Unique feature: Partner offers and rewards\n\n‚Ä¢ ICICI Direct\n  - Process time: 2-3 days\n  - AMC: ‚Çπ500-750+GST per year\n  - Unique feature: 3-in-1 account with ICICI Bank\n\nüîí Security Best Practices\n\n‚Ä¢ Use strong, unique passwords\n‚Ä¢ Enable two-factor authentication\n‚Ä¢ Never share OTPs or login credentials\n‚Ä¢ Check transaction alerts promptly\n‚Ä¢ Update contact details when they change\n‚Ä¢ Review holdings statements periodically\n\nüí° Pro Tips\n\n‚Ä¢ Compare AMC charges across brokers before deciding\n‚Ä¢ Look for promotional offers waiving first-year AMC\n‚Ä¢ Check if holding certain account balances reduces/eliminates fees\n‚Ä¢ If you have multiple demat accounts, consolidate to reduce AMC costs\n‚Ä¢ Basic accounts are sufficient for beginners; premium features can be added later\n\nOnce your demat account is active, you can start investing in stocks, ETFs, bonds, and apply for IPOs. The entire process has become significantly easier in recent years, with most accounts now being opened entirely online within hours.'
        },
        {
          module_id: module3Data[0].id,
          title: 'Understanding Brokerage Charges',
          lesson_order: 3,
          content: 'Understanding brokerage charges and other fees is crucial for investors, as these costs can significantly impact your overall returns over time. Here\'s a comprehensive breakdown of the various charges you\'ll encounter when investing in the Indian stock market:\n\nüí∏ Types of Charges\n\n1. Brokerage Fees\n   ‚Ä¢ Traditional Full-Service Brokers\n     - Percentage-based model: 0.3-0.5% per trade (buy and sell separately)\n     - Example: On a ‚Çπ10,000 trade, brokerage could be ‚Çπ30-50 each way\n   \n   ‚Ä¢ Discount Brokers\n     - Flat fee model: ‚Çπ0-20 per executed order regardless of trade size\n     - Delivery trades often free (Zerodha, Groww, Upstox)\n     - Intraday/F&O typically ‚Çπ20 per executed order\n\n2. Regulatory Charges (Non-negotiable, applied by all brokers)\n   ‚Ä¢ Securities Transaction Tax (STT)\n     - Equity delivery: 0.1% on buy and sell value\n     - Equity intraday: 0.025% on sell side only\n     - F&O: Different rates for different instruments\n   \n   ‚Ä¢ Exchange Transaction Charges\n     - NSE/BSE: 0.00325% (approximate)\n   \n   ‚Ä¢ GST\n     - 18% on brokerage and transaction charges\n   \n   ‚Ä¢ SEBI Turnover Fee\n     - 0.0001% on trade value\n   \n   ‚Ä¢ Stamp Duty\n     - 0.003% on buy side only (state-specific)\n\n3. Demat Account Charges\n   ‚Ä¢ Annual Maintenance Charge (AMC)\n     - ‚Çπ200-750 + GST per year\n     - Some brokers waive this with conditions\n   \n   ‚Ä¢ DP Transaction Charges\n     - ‚Çπ13-35 per scrip for transferring shares from demat account\n\n4. Other Potential Fees\n   ‚Ä¢ Call & Trade Charges\n     - ‚Çπ20-50 per trade when placing orders via phone\n   \n   ‚Ä¢ Payment Gateway Charges\n     - 0-2% for certain payment methods\n   \n   ‚Ä¢ Account Inactivity Fees\n     - Some brokers charge if no trades for 6-12 months\n   \n   ‚Ä¢ Pledge/Unpledge Charges\n     - When using securities as collateral\n\nüìä Fee Comparison: Traditional vs. Discount Brokers\n\nScenario: Buying and selling shares worth ‚Çπ50,000\n\n‚Ä¢ Full-Service Broker (0.5% brokerage)\n  - Brokerage: ‚Çπ500 (total for buy & sell)\n  - STT: ~‚Çπ100\n  - Exchange + SEBI charges: ~‚Çπ35\n  - GST on brokerage + charges: ~‚Çπ96\n  - Stamp duty: ~‚Çπ15\n  - Total cost: ~‚Çπ746 (1.49% of trade value)\n\n‚Ä¢ Discount Broker (flat ‚Çπ20 per order)\n  - Brokerage: ‚Çπ40 (total for buy & sell)\n  - STT: ~‚Çπ100\n  - Exchange + SEBI charges: ~‚Çπ35\n  - GST on brokerage + charges: ~‚Çπ14\n  - Stamp duty: ~‚Çπ15\n  - Total cost: ~‚Çπ204 (0.41% of trade value)\n\nüßÆ Impact of Fees on Long-term Returns\n\nAssumption: ‚Çπ1,00,000 investment with 12% annual returns over 10 years\n\n‚Ä¢ With 0.5% transaction cost (buying & selling once)\n  - Future value: ~‚Çπ3,05,000\n  - Impact of costs: ~‚Çπ5,000 reduction\n\n‚Ä¢ With 1.5% transaction cost (buying & selling once)\n  - Future value: ~‚Çπ2,95,000\n  - Impact of costs: ~‚Çπ15,000 reduction\n\n‚Ä¢ For active traders making multiple transactions, the difference becomes even more significant\n\nüí° Smart Strategies to Minimize Costs\n\n1. Choose the Right Broker for Your Style\n   - Long-term investor? Prioritize low or zero delivery charges\n   - Active trader? Focus on overall platform cost and stability\n\n2. Optimize Order Size\n   - With discount brokers, larger orders are more cost-efficient\n   - Consider consolidating smaller purchases\n\n3. Minimize Churn\n   - Every trade incurs costs; avoid excessive buying and selling\n   - Long-term investing reduces overall transaction costs\n\n4. Use Limit Orders\n   - Market orders might execute at unfavorable prices\n   - Limit orders give price control and potentially better execution\n\n5. Avoid Penalties and Special Charges\n   - Maintain minimum balance requirements\n   - Submit documents on time to avoid penalties\n   - Use online trading to avoid call & trade charges\n\n6. Consider Broker Offers\n   - Look for AMC waiver conditions\n   - Some brokers offer reduced fees for high account balances\n   - Special offers for new account holders\n\n7. Use Direct Mutual Funds\n   - If investing via mutual funds, choose direct plans to save on commission\n\nüì± Cost Calculators\n\nMost brokers provide brokerage calculators on their websites and apps. Use these tools to estimate total costs before placing trades, especially for larger orders or new trading strategies.\n\nRemember: While low costs are important, don\'t compromise on reliability, customer service, and platform stability just to save marginal amounts in fees. A slightly higher fee from a reputable broker with excellent execution quality might actually save money in the long run.'
        },
        {
          module_id: module3Data[0].id,
          title: 'How to Place Your First Order',
          lesson_order: 4,
          content: 'Placing your first stock order can seem intimidating, but the process is straightforward once you understand the basics. This lesson will guide you through the entire process of executing your first trade in the Indian stock market.\n\nüîç Before Placing an Order: Research\n\n‚Ä¢ Identify Your Investment Goal\n  - Long-term wealth creation\n  - Regular income through dividends\n  - Short-term trading opportunities\n\n‚Ä¢ Research the Company\n  - Business model and competitive advantages\n  - Financial health (revenues, profits, debt levels)\n  - Management quality and track record\n  - Future growth prospects\n  - Valuation metrics (P/E ratio, P/B ratio, etc.)\n\n‚Ä¢ Use Information Sources\n  - Company financial reports\n  - Broker research reports\n  - Business news channels/websites\n  - Financial portals (Screener.in, Moneycontrol, Tickertape)\n\nüí∞ Fund Your Account\n\n‚Ä¢ Transfer Methods\n  - UPI (fastest option)\n  - IMPS/NEFT/RTGS\n  - Payment gateway\n\n‚Ä¢ Timing Consideration\n  - Funds should be available before placing orders\n  - Most brokers now offer instant funding\n\n‚Ä¢ Margin Requirements\n  - For delivery: 100% of purchase value\n  - For intraday: Varies by broker (typically 5-40%)\n\nüìà Types of Orders\n\n‚Ä¢ Market Order\n  - Executes immediately at the best available price\n  - Advantage: Guaranteed execution\n  - Disadvantage: No price guarantee\n  - Best used: When execution is more important than exact price\n\n‚Ä¢ Limit Order\n  - Executes only at specified price or better\n  - Advantage: Price control\n  - Disadvantage: May not execute if market doesn\'t reach your price\n  - Best used: When you have a specific price target\n\n‚Ä¢ Stop Loss Order\n  - Becomes a market order when stock reaches trigger price\n  - Advantage: Limits potential losses\n  - Best used: To protect profits or limit losses\n\n‚Ä¢ Stop Limit Order\n  - Combines features of stop loss and limit orders\n  - Advantage: Price protection with trigger\n  - Disadvantage: More complex to set up\n\n‚è±Ô∏è Order Validity\n\n‚Ä¢ Day Order\n  - Valid only for the current trading day\n  - Expires if not executed by market close\n\n‚Ä¢ Immediate or Cancel (IOC)\n  - Executes immediately, whatever portion possible\n  - Cancels any unfilled portion\n\n‚Ä¢ Good Till Triggered/Cancelled (GTT/GTC)\n  - Remains active until executed or cancelled\n  - Can span multiple trading days\n\nüì≤ Step-by-Step Guide to Place an Order\n\nUsing popular platforms (specific screens may vary slightly):\n\n1. Login to Your Trading Platform\n   - Enter user ID and password\n   - Complete two-factor authentication\n\n2. Search for the Stock\n   - Use the search bar to find the company\n   - Enter company name or stock symbol (e.g., TCS, RELIANCE)\n\n3. Review Stock Information\n   - Check current price and day\'s range\n   - Look at bid/ask prices and volumes\n\n4. Open Order Window\n   - Click "Buy" or "Sell" button next to the stock\n\n5. Configure Order Details\n   ‚Ä¢ Select Exchange (NSE/BSE)\n   ‚Ä¢ Choose Order Type\n     - For beginners: Start with a limit order slightly above market price for buy orders\n   ‚Ä¢ Enter Quantity\n     - Start small for your first few trades\n   ‚Ä¢ Enter Price (for Limit Orders)\n   ‚Ä¢ Select Product Type\n     - CNC/Delivery: For investment (shares delivered to demat)\n     - Intraday/MIS: For same-day trading (automatically squared off)\n\n6. Review Order Details\n   - Double-check all parameters\n   - Verify total investment amount\n\n7. Submit Order\n   - Click "Place Order" or "Submit"\n\n8. Confirm Execution\n   - Check "Order Book" to see status\n   - Look for "Executed" status\n\nüîé Platform-Specific Examples\n\n‚Ä¢ Zerodha Kite\n   - Search stock in the top bar\n   - Click on the stock name\n   - Select Buy/Sell from the right panel\n   - Configure order parameters\n   - Click "Buy" or "Sell" button\n\n‚Ä¢ Groww\n   - Search stock in the search bar\n   - Go to stock page\n   - Click "Buy" or "Sell" button\n   - Enter quantity and order type\n   - Review and confirm order\n\n‚ö†Ô∏è Common Mistakes to Avoid\n\n‚Ä¢ Confusing Limit and Market Orders\n  - Market orders execute immediately at current price\n  - Limit orders only execute at your specified price or better\n\n‚Ä¢ Selecting Wrong Product Type\n  - Using Intraday (MIS) when intending to invest long-term\n  - Using Delivery (CNC) for short-term trades\n\n‚Ä¢ Entering Incorrect Quantities\n  - Check for lot sizes in F&O\n  - Verify total investment amount\n\n‚Ä¢ Ignoring Circuit Limits\n  - Daily price movement restrictions (typically 5%, 10%, 20%)\n\n‚Ä¢ Forgetting to Check Fund Availability\n  - Ensure sufficient balance before placing orders\n\nüí° Tips for First-Time Traders\n\n‚Ä¢ Start Small\n  - Begin with a modest amount you\'re comfortable losing\n  - Consider ‚Çπ5,000-10,000 for your first few trades\n\n‚Ä¢ Use Limit Orders\n  - Provides price protection compared to market orders\n\n‚Ä¢ Choose Liquid Stocks\n  - Large-cap stocks have tighter spreads and better execution\n  - Examples: HDFC Bank, TCS, Reliance, Infosys\n\n‚Ä¢ Keep Records\n  - Note purchase price, date, and reasons for buying\n  - Helpful for learning and tax purposes\n\n‚Ä¢ Start During Regular Market Hours\n  - Avoid first and last 30 minutes when volatility is highest\n  - Best time: 10:30 AM to 2:30 PM\n\nRemember: Your first trade is an important learning experience. Focus on understanding the process rather than making a profit. As you gain confidence, you can gradually increase your investment amount and explore other order types and strategies.'
        }
      ]);

    // Module 4: Smart Investment Practices
    const { data: module4Data, error: module4Error } = await supabase
      .from('course_modules')
      .insert({
        course_id: courseId,
        title: 'Smart Investment Practices',
        description: 'Learn about effective investment strategies and common pitfalls to avoid',
        module_order: 4,
        content: 'This module covers essential investment practices that can help you build wealth over time and avoid common mistakes that beginners make.'
      })
      .select();

    if (module4Error) throw module4Error;
    
    await supabase
      .from('lessons')
      .insert([
        {
          module_id: module4Data[0].id,
          title: 'Diversification: Don\'t Put All Eggs in One Basket',
          lesson_order: 1,
          content: 'Diversification is one of the most fundamental principles of successful investing. It\'s the strategy of spreading your investments across various assets to reduce risk while potentially improving returns. Let\'s understand why and how to implement this crucial strategy.\n\nüõ°Ô∏è Why Diversification Matters\n\n‚Ä¢ Risk Reduction\n  - Prevents catastrophic losses from a single investment\n  - Different assets often respond differently to market events\n  - Example: When COVID-19 hit in 2020, while travel stocks crashed, pharmaceutical and technology stocks thrived\n\n‚Ä¢ Smooths Investment Journey\n  - Reduces portfolio volatility\n  - Creates more consistent returns over time\n  - Makes it easier to stay invested during market turbulence\n\n‚Ä¢ Captures Opportunities\n  - Positions you to benefit from growth in different sectors\n  - Allows exposure to emerging trends and industries\n\n‚Ä¢ Protects Against Uncertainty\n  - Markets are unpredictable\n  - Even expert predictions are often wrong\n  - No single company or sector performs best every year\n\nüìä Types of Diversification\n\n1. Asset Class Diversification\n   - Spreading investments across different investment categories:\n     ‚Ä¢ Stocks (equity)\n     ‚Ä¢ Bonds (debt)\n     ‚Ä¢ Gold\n     ‚Ä¢ Real estate\n     ‚Ä¢ Cash and equivalents\n   - These asset classes often move independently of each other\n\n2. Equity Diversification\n   - Across Market Caps\n     ‚Ä¢ Large-cap: Stability\n     ‚Ä¢ Mid-cap: Growth with moderate risk\n     ‚Ä¢ Small-cap: Higher growth potential with higher risk\n   \n   - Across Sectors\n     ‚Ä¢ Financial services\n     ‚Ä¢ Information technology\n     ‚Ä¢ Consumer goods\n     ‚Ä¢ Healthcare\n     ‚Ä¢ Energy\n     ‚Ä¢ Manufacturing\n     ‚Ä¢ And others\n   \n   - Across Geographies\n     ‚Ä¢ Domestic (Indian companies)\n     ‚Ä¢ International (US, European, emerging markets)\n\n3. Time Diversification\n   - Investing gradually over time rather than all at once\n   - Systematic Investment Plans (SIPs) implement this automatically\n   - Reduces risk of entering market at a peak\n\nüõ†Ô∏è Practical Diversification Strategies\n\n‚Ä¢ For Beginners (Investment <‚Çπ1 Lakh)\n  - Start with mutual funds or ETFs instead of individual stocks\n  - Consider index funds that naturally provide diversification\n  - Example portfolio:\n    ‚Ä¢ 70% Nifty 50 Index Fund\n    ‚Ä¢ 20% Mid-cap Fund\n    ‚Ä¢ 10% Gold ETF\n\n‚Ä¢ For Growing Portfolios (‚Çπ1-5 Lakhs)\n  - Add more specific exposures\n  - Example portfolio:\n    ‚Ä¢ 40% Large-cap Fund\n    ‚Ä¢ 20% Mid-cap Fund\n    ‚Ä¢ 10% Small-cap Fund\n    ‚Ä¢ 20% Debt Fund\n    ‚Ä¢ 10% Gold\n\n‚Ä¢ For Larger Portfolios (>‚Çπ5 Lakhs)\n  - Consider individual stocks alongside funds\n  - Add international exposure\n  - Example portfolio:\n    ‚Ä¢ 30% Individual Large-cap Stocks (8-10 companies across sectors)\n    ‚Ä¢ 25% Mid and Small-cap Funds\n    ‚Ä¢ 15% International Fund\n    ‚Ä¢ 20% Debt Instruments\n    ‚Ä¢ 10% Gold and Alternative Investments\n\n‚ö†Ô∏è Diversification Pitfalls to Avoid\n\n‚Ä¢ Over-Diversification\n  - Too many investments can lead to index-like returns with higher costs\n  - For stocks: 15-20 carefully selected companies is typically sufficient\n  - For mutual funds: 5-8 funds across categories is usually adequate\n\n‚Ä¢ False Diversification\n  - Having multiple similar investments doesn\'t provide true diversification\n  - Example: Owning 5 large-cap IT stocks or 3 large-cap mutual funds with similar holdings\n\n‚Ä¢ Ignoring Correlation\n  - Some investments tend to move together despite appearing different\n  - Example: Many financial and real estate stocks may fall simultaneously during credit crises\n\n‚Ä¢ Neglecting Regular Rebalancing\n  - As investments grow at different rates, your allocation shifts\n  - Without rebalancing, portfolio can become too concentrated in high-performing assets\n  - Typically rebalance once or twice per year\n\nüíº Real-World Example\n\nConsider how differently diversified portfolios performed during major market events:\n\n2008 Global Financial Crisis (approximate returns)\n- 100% Indian Equity: -50%\n- 100% Gold: +25%\n- Diversified Portfolio (60% Equity, 30% Bonds, 10% Gold): -20%\n\n2020 COVID Crash and Recovery\n- IT Sector: +45% (full year)\n- Banking Sector: -15% (full year)\n- Pharma Sector: +30% (full year)\n- Diversified across sectors: +15% (full year)\n\nThe diversified approaches significantly reduced drawdowns during crises while still participating in recoveries.\n\nüîÑ When to Adjust Your Diversification\n\n‚Ä¢ Life Stage Changes\n  - Approaching retirement: Usually increase allocation to stable assets\n  - Young with secure income: Can typically take more equity exposure\n\n‚Ä¢ Major Market Shifts\n  - Significant valuation disparities between asset classes\n  - Fundamental economic changes\n\n‚Ä¢ Risk Tolerance Changes\n  - Personal comfort with volatility may evolve\n  - Financial circumstances may change\n\nRemember: Diversification doesn\'t guarantee profits or prevent losses in a market downturn, but it does help manage risk and potentially improve the risk-adjusted return of your portfolio over time.'
        },
        {
          module_id: module4Data[0].id,
          title: 'Long-Term vs Short-Term Investing',
          lesson_order: 2,
          content: 'Understanding the differences between long-term and short-term investing approaches is crucial for developing a successful investment strategy. Each approach has distinct characteristics, advantages, and challenges that suit different investor profiles and goals.\n\n‚è±Ô∏è Time Horizon Definitions\n\n‚Ä¢ Short-Term Investing\n  - Typically holding periods of less than 1 year\n  - Examples: Day trading, swing trading, positional trading\n  - Focus: Price movements, technical patterns, momentum\n\n‚Ä¢ Medium-Term Investing\n  - Holding periods of 1-3 years\n  - Focus: Company growth prospects, sector trends\n\n‚Ä¢ Long-Term Investing\n  - Holding periods of 3+ years, often 5-10+ years\n  - Focus: Fundamental value, compounding, business quality\n\nüîç Key Differences\n\n‚Ä¢ Investment Approach\n  \n  Long-Term:\n  - Based on company fundamentals and business quality\n  - Evaluates management, competitive advantages, growth potential\n  - Example metrics: P/E ratio, ROE, profit growth, debt-to-equity\n  \n  Short-Term:\n  - Focuses on price movements and market sentiment\n  - Uses technical analysis, charts, momentum indicators\n  - Example tools: Moving averages, RSI, volume analysis\n\n‚Ä¢ Risk and Return Profile\n  \n  Long-Term:\n  - Lower volatility impact over time\n  - Historically higher probability of positive returns\n  - Allows compounding to work (returns generating more returns)\n  \n  Short-Term:\n  - Higher volatility impact\n  - Greater probability of losses\n  - Potential for quick gains but also quick losses\n\n‚Ä¢ Psychological Factors\n  \n  Long-Term:\n  - Less time-intensive monitoring\n  - Reduced emotional decision-making\n  - Focus on business results rather than price movements\n  \n  Short-Term:\n  - Constant monitoring required\n  - Higher stress and emotional involvement\n  - Requires strict discipline and trading rules\n\n‚Ä¢ Tax Implications\n  \n  Long-Term (in India):\n  - Long-term capital gains tax: 10% above ‚Çπ1 lakh (for equity)\n  - No indexation benefit for equity investments\n  \n  Short-Term (in India):\n  - Short-term capital gains tax: 15% (for equity)\n  - Higher tax burden reduces net returns\n\nüìà Historical Performance Data\n\nNifty 50 Returns (approximate historical data):\n\n‚Ä¢ Daily Returns:\n  - Positive days: ~52%\n  - Negative days: ~48%\n  - Significant volatility\n\n‚Ä¢ Monthly Returns:\n  - Positive months: ~60%\n  - Negative months: ~40%\n\n‚Ä¢ 1-Year Periods:\n  - Positive years: ~70%\n  - Negative years: ~30%\n\n‚Ä¢ 5-Year Periods:\n  - Positive 5-year periods: ~85%\n  - Negative 5-year periods: ~15%\n\n‚Ä¢ 10-Year Periods:\n  - Positive 10-year periods: ~99%\n  - Negative 10-year periods: ~1%\n\nThis data illustrates how time reduces the probability of negative returns in equity investments.\n\nüí∞ Power of Compounding (Long-Term Advantage)\n\nExample: ‚Çπ1 lakh invested with 12% annual returns\n\n‚Ä¢ After 1 year: ‚Çπ1.12 lakh (+‚Çπ12,000)\n‚Ä¢ After 5 years: ‚Çπ1.76 lakh (+‚Çπ76,000)\n‚Ä¢ After 10 years: ‚Çπ3.11 lakh (+‚Çπ2.11 lakh)\n‚Ä¢ After 20 years: ‚Çπ9.65 lakh (+‚Çπ8.65 lakh)\n‚Ä¢ After 30 years: ‚Çπ30 lakh (+‚Çπ29 lakh)\n\nNote how returns accelerate in later years due to compounding.\n\nüèÜ Who Succeeds in Each Approach?\n\n‚Ä¢ Successful Long-Term Investors\n  - Patient and disciplined\n  - Focus on business fundamentals\n  - Emotionally stable during market volatility\n  - Examples: Warren Buffett, Rakesh Jhunjhunwala\n\n‚Ä¢ Successful Short-Term Traders\n  - Highly disciplined with strict rules\n  - Excellent at managing risk\n  - Psychologically resilient to losses\n  - Often have significant experience and resources\n  - Examples: Professional traders, algorithmic systems\n\nü§î Which Approach is Right for You?\n\n‚Ä¢ Consider Long-Term Investing If:\n  - You have a full-time job outside finance\n  - You seek wealth creation without constant monitoring\n  - You have emotional discipline to withstand market fluctuations\n  - You prefer tax efficiency\n  - You\'re investing for distant goals (retirement, children\'s education)\n\n‚Ä¢ Consider Short-Term Trading If:\n  - You can dedicate significant time to market analysis\n  - You have strong emotional discipline and risk management skills\n  - You have sufficient capital to absorb potential losses\n  - You\'ve thoroughly educated yourself on trading techniques\n  - You understand most retail traders lose money short-term\n\nüîÑ Hybrid Approaches\n\n‚Ä¢ Core-Satellite Strategy\n  - Core portfolio (70-80%): Long-term investments in quality companies\n  - Satellite portfolio (20-30%): Tactical shorter-term positions\n  - Combines stability with opportunistic gains\n\n‚Ä¢ Systematic Medium-Term Approach\n  - Hold investments for 1-3 years\n  - Based on both fundamentals and technical factors\n  - Blends aspects of both approaches\n\nüí° Tips for Beginners\n\n1. Start with long-term investing to build foundational knowledge\n2. Learn market mechanics through small, long-term investments first\n3. Understand that short-term trading is much more difficult than it appears\n4. If interested in short-term trading, practice with paper trading before using real money\n5. Remember that many successful investors like Rakesh Jhunjhunwala built wealth primarily through long-term holdings\n\nFor most individual investors, especially those with limited time and resources, long-term investing offers the highest probability of success and wealth creation.'
        },
        {
          module_id: module4Data[0].id,
          title: 'Common Mistakes Beginners Make',
          lesson_order: 3,
          content: 'Avoiding common investing mistakes can be as important as making the right investment choices. By learning these pitfalls in advance, you can save yourself from costly errors that many beginners experience. Here are the most frequent mistakes and how to avoid them:\n\nüîÆ Unrealistic Expectations\n\n‚Ä¢ The Mistake\n  - Expecting quick, large returns (like 50%+ annually)\n  - Believing you can consistently time market highs and lows\n  - Expecting every stock pick to be a winner\n\n‚Ä¢ Why It Happens\n  - Media highlights exceptional success stories\n  - Social media posts showcase wins but rarely losses\n  - Natural human optimism bias\n\n‚Ä¢ How to Avoid It\n  - Set realistic expectations: 12-15% long-term returns are excellent\n  - Understand that even professional investors make wrong calls\n  - Accept that market timing consistently is virtually impossible\n\nüêë Following the Crowd (Herd Mentality)\n\n‚Ä¢ The Mistake\n  - Buying stocks just because everyone else is buying\n  - Investing based on tips from friends or social media\n  - Panic selling during market crashes when others are selling\n\n‚Ä¢ Why It Happens\n  - Social validation makes us feel safer\n  - Fear of missing out (FOMO) drives impulsive decisions\n  - Humans naturally seek safety in groups\n\n‚Ä¢ How to Avoid It\n  - Develop your own investment thesis for each purchase\n  - Question popular narratives critically\n  - Remember Warren Buffett\'s advice: "Be fearful when others are greedy, and greedy when others are fearful"\n\nüì± Over-Trading\n\n‚Ä¢ The Mistake\n  - Buying and selling too frequently\n  - Constantly checking stock prices\n  - Making decisions based on short-term price movements\n\n‚Ä¢ Why It Happens\n  - Technological ease of trading (apps make it too simple)\n  - Dopamine hit from trading activity\n  - Illusion of control through frequent action\n\n‚Ä¢ How to Avoid It\n  - Set a minimum holding period for investments\n  - Check your portfolio less frequently (weekly or monthly)\n  - Track your trading results to see the impact of fees and taxes\n\n‚ùì Inadequate Research\n\n‚Ä¢ The Mistake\n  - Investing without understanding the business\n  - Buying based on price movement alone\n  - Not reading company reports or financial statements\n\n‚Ä¢ Why It Happens\n  - Research takes time and effort\n  - Financial jargon can be intimidating\n  - Quick decisions seem more exciting\n\n‚Ä¢ How to Avoid It\n  - Learn to read basic financial statements\n  - Understand what the company does and how it makes money\n  - Start with industries you know or can easily understand\n  - Use resources like Annual Reports, Screener.in, Tijori Finance\n\nüéÆ Treating Investing Like Gambling\n\n‚Ä¢ The Mistake\n  - Seeking thrills rather than returns\n  - Making impulsive, emotionally-driven decisions\n  - Taking excessive risks for entertainment\n\n‚Ä¢ Why It Happens\n  - Market volatility creates excitement\n  - Quick gains provide dopamine rushes\n  - Social media glorifies trading "wins"\n\n‚Ä¢ How to Avoid It\n  - Set clear investment goals\n  - Create and follow a written investment plan\n  - Separate entertainment funds from serious investments\n\nüìä Ignoring Asset Allocation\n\n‚Ä¢ The Mistake\n  - Putting all money in a single stock or sector\n  - Not considering your risk tolerance\n  - Ignoring the importance of diversification\n\n‚Ä¢ Why It Happens\n  - Overconfidence in specific companies or sectors\n  - Complexity of building a balanced portfolio\n  - Excitement about high-growth areas\n\n‚Ä¢ How to Avoid It\n  - Define your asset allocation based on risk tolerance and time horizon\n  - Regularly rebalance your portfolio\n  - Consider starting with index funds or well-diversified mutual funds\n\nüß† Emotional Decision-Making\n\n‚Ä¢ The Mistake\n  - Selling due to fear during market declines\n  - Holding losing positions due to emotional attachment\n  - Making investment decisions based on regret or FOMO\n\n‚Ä¢ Why It Happens\n  - Human brains evolved for survival, not investing\n  - Loss aversion makes losses feel twice as painful as gains feel good\n  - Recency bias causes overreaction to latest events\n\n‚Ä¢ How to Avoid It\n  - Create investment rules and follow them\n  - Keep an investment journal to track decisions and emotions\n  - Implement a cooling-off period before major decisions\n\nüí∏ Ignoring Costs and Taxes\n\n‚Ä¢ The Mistake\n  - Not considering impact of brokerage fees\n  - Frequent trading that generates high tax bills\n  - Overlooking expense ratios in mutual funds\n\n‚Ä¢ Why It Happens\n  - Focus on gross returns rather than net returns\n  - Small percentages seem insignificant (but compound over time)\n  - Tax implications aren\'t immediately visible\n\n‚Ä¢ How to Avoid It\n  - Calculate the total cost of ownership for investments\n  - Consider tax-efficient strategies (like long-term holding)\n  - Choose low-cost brokers and investment products\n\nüèÉ‚Äç‚ôÇÔ∏è Chasing Performance\n\n‚Ä¢ The Mistake\n  - Investing in last year\'s best-performing stocks/funds\n  - Abandoning strategies after short-term underperformance\n  - Constantly switching to "hot" sectors\n\n‚Ä¢ Why It Happens\n  - Past performance is highly visible\n  - Confirmation bias from seeing others succeed\n  - Media focus on winners creates availability bias\n\n‚Ä¢ How to Avoid It\n  - Understand that market leadership rotates\n  - Focus on long-term trends rather than recent performance\n  - Look for quality and value rather than momentum alone\n\nüìö Not Investing in Knowledge\n\n‚Ä¢ The Mistake\n  - Starting to invest without basic financial literacy\n  - Not keeping up with companies you\'ve invested in\n  - Ignoring broader economic trends\n\n‚Ä¢ Why It Happens\n  - Investing seems simpler than it is\n  - Information overload causes avoidance\n  - Learning takes time and effort\n\n‚Ä¢ How to Avoid It\n  - Read investment books by proven investors\n  - Follow reliable financial news sources\n  - Join investment communities for learning (not for tips)\n  - Consider investing courses from credible sources\n\nRemember that making mistakes is part of the learning process. Even experienced investors make errors occasionally. The key is to learn from them and gradually improve your decision-making process over time.'
        },
        {
          module_id: module4Data[0].id,
          title: 'Using Simple Tools (Moneycontrol, Screener.in)',
          lesson_order: 4,
          content: 'Having the right tools can dramatically improve your investment research and decision-making process. Let\'s explore some accessible and powerful tools that are particularly useful for beginner investors in India.\n\nüîç Financial Information Portals\n\n‚Ä¢ Moneycontrol\n  - India\'s leading financial portal\n  - Features:\n    ‚Ä¢ Company profiles with key financial data\n    ‚Ä¢ Real-time price updates\n    ‚Ä¢ News and announcements\n    ‚Ä¢ Portfolio tracking\n    ‚Ä¢ Basic charts\n\n  - How to Use Effectively:\n    1. Company Research\n       ‚Ä¢ Search for company name/ticker\n       ‚Ä¢ Review "Financials" tab for quarterly/annual reports\n       ‚Ä¢ Check "Ratios" section for valuation metrics\n       ‚Ä¢ Look at shareholding patterns under "Holding Analysis"\n\n    2. News & Events\n       ‚Ä¢ Company-specific press releases\n       ‚Ä¢ Results announcements\n       ‚Ä¢ Industry news that may impact investments\n\n    3. Portfolio Management\n       ‚Ä¢ Create watchlists of potential investments\n       ‚Ä¢ Track performance of existing holdings\n       ‚Ä¢ Set price alerts for buying opportunities\n\n‚Ä¢ Screener.in\n  - Focused on fundamental analysis\n  - Features:\n    ‚Ä¢ Comprehensive financial data in user-friendly format\n    ‚Ä¢ Customizable stock screeners\n    ‚Ä¢ Export capabilities for further analysis\n    ‚Ä¢ Peer comparison tools\n\n  - How to Use Effectively:\n    1. Company Analysis\n       ‚Ä¢ View "QuickFS" for at-a-glance financials\n       ‚Ä¢ Check growth trends in sales, profits, margins\n       ‚Ä¢ Review red flags like high debt or declining return ratios\n       ‚Ä¢ Analyze cash flow statements (often overlooked by beginners)\n\n    2. Custom Screeners\n       ‚Ä¢ Create filters based on your investment criteria\n       ‚Ä¢ Example beginner-friendly screen:\n         - Market cap > ‚Çπ5,000 crore (stability)\n         - ROE > 15% (profitability)\n         - Debt to Equity < 1 (financial health)\n         - 5-year sales growth > 10% (consistent growth)\n\n    3. Peer Comparison\n       ‚Ä¢ Compare companies within the same sector\n       ‚Ä¢ Identify outperformers and underperformers\n       ‚Ä¢ Understand industry benchmarks\n\nüì∞ News and Research Sources\n\n‚Ä¢ Economic Times Markets\n  - Comprehensive market news\n  - Broker research reports summaries\n  - Expert opinions and interviews\n  - Market data and tools\n\n‚Ä¢ Tijori Finance\n  - Simplified company information\n  - Visual representation of financial data\n  - Business model explanations in plain language\n  - Well-suited for beginners\n\n‚Ä¢ Value Research\n  - Excellent for mutual fund research\n  - Fund comparisons and ratings\n  - Portfolio analysis tools\n  - Educational content for beginners\n\nüìä Technical Analysis Tools\n\n‚Ä¢ TradingView\n  - Advanced charting platform (free basic version)\n  - Features:\n    ‚Ä¢ Interactive charts with multiple timeframes\n    ‚Ä¢ Technical indicators and drawing tools\n    ‚Ä¢ Community-shared ideas and analysis\n    ‚Ä¢ Watchlists and alerts\n\n  - How to Use as a Beginner:\n    ‚Ä¢ Start with simple indicators (Moving Averages, RSI, MACD)\n    ‚Ä¢ Use to identify support/resistance levels\n    ‚Ä¢ Look for basic patterns (trends, reversals)\n    ‚Ä¢ Learn from community charts and annotations\n\n‚Ä¢ Investing.com\n  - User-friendly charts and tools\n  - Economic calendar for upcoming events\n  - Technical analysis summaries\n  - Global market coverage\n\nüì± Mobile Apps for On-the-Go Research\n\n‚Ä¢ Tickertape\n  - Clean, beginner-friendly interface\n  - Quick company overviews\n  - Built-in stock screener\n  - Portfolio tracking with insights\n\n‚Ä¢ StockEdge\n  - Technical and fundamental data\n  - Pre-built screens and filters\n  - Market movers and sector performance\n  - Educational content within app\n\nüßÆ Calculators and Planning Tools\n\n‚Ä¢ Zerodha Coin\'s SIP Calculator\n  - Estimate future value of investments\n  - Adjust parameters to see different scenarios\n  - Understand power of compounding visually\n\n‚Ä¢ Tax Tools\n  - TDSL\'s Capital Gains Calculator\n  - Helps estimate tax liability on investments\n  - Particularly useful at financial year-end\n\n‚Ä¢ Zerodha Varsity\n  - Not just a tool but extensive educational resource\n  - Modules from basics to advanced topics\n  - Interactive calculators and practical examples\n\nüíº Portfolio Trackers\n\n‚Ä¢ Google Sheets (DIY approach)\n  - Completely customizable\n  - Can use functions like GOOGLEFINANCE to fetch live data\n  - Templates available online\n\n‚Ä¢ MProfit\n  - Comprehensive portfolio tracking\n  - Tax reports generation\n  - Capital gains calculations\n  - Paid software but powerful for serious investors\n\n‚Ä¢ Your broker\'s platform\n  - Most brokers offer built-in portfolio analysis\n  - Shows purchase price, current value, gain/loss\n  - Some offer advanced analytics on risk and diversification\n\nüìã Practical Workflow for Beginners\n\n1. Initial Company Discovery\n   - Use Screener.in to filter companies meeting basic criteria\n   - Create a watchlist of potential investments\n\n2. Basic Research\n   - Review company profiles on Moneycontrol or Tijori Finance\n   - Understand the business model and competitive position\n\n3. Detailed Analysis\n   - Dive deeper into financials on Screener.in\n   - Check recent news on Economic Times Markets\n   - Review annual reports (available on company websites)\n\n4. Valuation Check\n   - Compare valuation ratios to historical averages and peers\n   - Look for reasonable valuations relative to growth prospects\n\n5. Technical Review (Optional)\n   - Check price trends on TradingView\n   - Look for potential entry points\n\n6. Decision and Tracking\n   - Make investment decision based on research\n   - Add to portfolio tracker\n   - Set up news alerts to stay informed about company developments\n\nüí° Pro Tips for Using These Tools\n\n‚Ä¢ Don\'t rely on a single source ‚Äì cross-verify information\n‚Ä¢ Start with simple metrics before moving to complex analyses\n‚Ä¢ Use tools consistently to develop your research process\n‚Ä¢ Take advantage of free educational resources offered by these platforms\n‚Ä¢ Set aside specific time for research rather than checking randomly\n\nRemember that tools are aids to decision-making, not substitutes for critical thinking. As you gain experience, you\'ll develop your own workflow using the tools that best suit your investment style.'
        }
      ]);

    return { success: true, courseId };
  } catch (error) {
    console.error('Error setting up Stock Investment course:', error);
    return { success: false, error };
  }
};

/**
 * Auto create purchase records for demonstration purposes
 */
const createDemoPurchases = async (userId: string) => {
  try {
    // Get all courses
    const { data: courses } = await supabase
      .from('courses')
      .select('id');
    
    if (!courses || courses.length === 0) return;
    
    // Create demo purchase records for all courses for the current user
    const purchases = courses.map(course => ({
      user_id: userId,
      course_id: course.id,
      has_used_referral_code: false
    }));
    
    await supabase
      .from('purchases')
      .upsert(purchases, { onConflict: 'user_id,course_id' });
      
  } catch (error) {
    console.error('Error creating demo purchases:', error);
  }
};

/**
 * Initialize application data
 */
export const initializeAppData = async (userId: string | undefined): Promise<void> => {
  try {
    // Check if courses exist
    const coursesExist = await areCoursesSetUp();
    
    // If courses don't exist, create them
    if (!coursesExist) {
      console.log('Setting up initial courses...');
      await setupAIToolsCourse();
      await setupStockInvestmentCourse();
    }
    
    // Create demo purchases for logged in user if available
    if (userId) {
      await createDemoPurchases(userId);
    }
  } catch (error) {
    console.error('Error initializing app data:', error);
  }
};
