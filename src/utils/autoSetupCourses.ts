
import { supabase } from '@/integrations/supabase/client';

interface InitResult {
  success: boolean;
  error?: any;
  message?: string;
}

/**
 * Creates initial courses with modules and lessons if they don't exist.
 * This handles automatic data setup for a consistent demo experience.
 */
export const initializeAppData = async (): Promise<InitResult> => {
  try {
    console.log("Starting app data initialization...");
    const result = await createCourses();
    return result;
  } catch (error) {
    console.error("Error in initializeAppData:", error);
    return { success: false, error };
  }
};

/**
 * Function to manually trigger initialization, used by admin panel
 */
export const triggerInitialization = async (): Promise<InitResult> => {
  try {
    console.log("Manually triggering course initialization...");
    const result = await createCourses();
    return result;
  } catch (error) {
    console.error("Error in triggerInitialization:", error);
    return { success: false, error };
  }
};

// Define AI Tools course structure
const aiToolsCourseModules = [
  {
    title: "Introduction to AI Tools",
    description: "Understanding the AI landscape and key tools",
    module_order: 1,
    lessons: [
      {
        title: "The AI Revolution in Learning",
        content: "## Welcome to the AI Tools Revolution\n\nArtificial Intelligence is transforming the way we work, learn, and create. This introductory lesson explores the current AI landscape and how these tools can enhance your academic and professional journey.\n\n### What Are AI Tools?\n\nAI tools are software applications that leverage artificial intelligence to perform tasks that typically require human intelligence. These tools can:\n\n- Generate and edit written content\n- Create images, audio, and video from text descriptions\n- Analyze and summarize large amounts of information\n- Translate languages with remarkable accuracy\n- Provide personalized learning experiences\n\n### The Evolution of AI Tools\n\nThe recent explosion in AI capabilities can be traced to advancements in deep learning and specifically large language models (LLMs). Here's a brief timeline:\n\n- **2010s**: Early AI assistants like Siri and Alexa emerge\n- **2020**: GPT-3 demonstrates unprecedented text generation abilities\n- **2021**: DALL-E and Midjourney introduce text-to-image generation\n- **2022**: ChatGPT brings conversational AI to the mainstream\n- **2023-24**: Multimodal AI systems that combine text, image, and audio capabilities become widely available\n\n### Why Learn About AI Tools?\n\n#### 1. Productivity Enhancement\n\nAI tools can help you complete tasks faster by:\n- Generating first drafts of written content\n- Summarizing research papers and long articles\n- Creating visual aids and presentations\n- Organizing and structuring information\n\n#### 2. Learning Acceleration\n\nAI can enhance your learning process by:\n- Explaining complex concepts in simple terms\n- Generating practice questions and quizzes\n- Providing immediate feedback on your work\n- Creating personalized study materials\n\n#### 3. Creative Amplification\n\nAI tools can boost your creativity by:\n- Helping overcome creative blocks with suggestions\n- Visualizing concepts through image generation\n- Exploring alternative approaches to problems\n- Combining ideas in novel ways\n\n#### 4. Future-Proofing Your Skills\n\nAs AI continues to integrate into every industry, understanding how to effectively use these tools becomes increasingly valuable. The professionals who thrive will be those who know how to:\n- Strategically leverage AI for appropriate tasks\n- Critically evaluate AI outputs\n- Direct AI tools with effective inputs (prompts)\n- Combine human creativity with AI capabilities\n\n### The AI Tools Landscape\n\n#### Text-Based AI Tools\n- **ChatGPT**: Conversational AI assistant\n- **Google Gemini**: Google's multimodal AI model\n- **Claude**: Anthropic's AI assistant focused on helpfulness and harmlessness\n- **Bing Chat/Copilot**: Microsoft's AI integrated into search and productivity tools\n\n#### Image Generation Tools\n- **DALL-E**: OpenAI's text-to-image generator\n- **Midjourney**: Creates artistic interpretations from text prompts\n- **Stable Diffusion**: Open-source image generation model\n\n#### Research and Writing Tools\n- **Elicit**: AI research assistant\n- **Consensus**: Scientific paper search and summary\n- **Grammarly**: Grammar checking and writing enhancement\n\n#### Learning and Education Tools\n- **Duolingo Max**: AI-enhanced language learning\n- **Khan Academy Khanmigo**: AI tutor for various subjects\n- **Quizlet Q-Chat**: Study aid and quiz generator\n\n### Effective and Ethical Use of AI Tools\n\nIt's important to approach AI tools with both excitement and responsibility:\n\n1. **Know when to use AI**: Ideal for brainstorming, first drafts, and information organization\n\n2. **Know when not to use AI**: Less suitable for final work submission, factual accuracy without verification, or sensitive personal information\n\n3. **Verify information**: AI can generate plausible-sounding but incorrect information (hallucinations)\n\n4. **Understand academic integrity**: Follow your institution's guidelines on AI tool usage\n\n5. **Develop complementary skills**: Critical thinking, creativity, and interpersonal abilities remain uniquely human advantages\n\n### Key Takeaways\n\n- AI tools represent a powerful new category of productivity and learning technology\n- These tools excel at content generation, information processing, and personalized assistance\n- Learning to use AI tools effectively is becoming an essential skill across disciplines\n- The most successful approach combines AI capabilities with human creativity and judgment\n\nIn the next lesson, we'll explore effective prompting techniques to get the most value from AI tools.",
        lesson_order: 1
      },
      {
        title: "Effective Prompting Techniques",
        content: "## Mastering the Art of AI Prompting\n\nThe quality of output you receive from AI writing tools depends heavily on the quality of your prompts. This lesson teaches you how to craft effective prompts that deliver exactly what you need for your academic work.\n\n### The Elements of an Effective Prompt\n\n#### 1. Be Specific and Detailed\n\n*Weak Prompt:* \"Write about climate change.\"\n\n*Strong Prompt:* \"Write a 500-word explanation of how climate change affects marine ecosystems, focusing on coral reef degradation, suitable for a first-year environmental science assignment.\"\n\nThe specific prompt provides clear guidance on topic, length, focus, and audience, resulting in more useful output.\n\n#### 2. Provide Context\n\n*Weak Prompt:* \"Help me write about Hamlet.\"\n\n*Strong Prompt:* \"I'm writing a literary analysis essay for my 12th-grade English class on the theme of indecision in Shakespeare's Hamlet. Can you help me develop three main arguments with textual evidence?\"\n\nContext helps the AI understand your academic level, assignment type, and specific analytical approach.\n\n#### 3. Specify Format and Structure\n\n*Weak Prompt:* \"Write about economic inequality.\"\n\n*Strong Prompt:* \"Create an outline for a 5-paragraph argumentative essay on economic inequality in the United States. Include a thesis statement, topic sentences for each paragraph, and suggestions for credible sources to cite.\"\n\nRequesting a specific format ensures the AI delivers content in a usable structure.\n\n#### 4. Define Your Role and the AI's Role\n\n*Weak Prompt:* \"Write my psychology essay.\"\n\n*Strong Prompt:* \"Act as a brainstorming partner for my developmental psychology essay. I'm exploring Piaget's cognitive development theory. Please ask me 5 thought-provoking questions that will help me develop my own thesis statement.\"\n\nThis establishes a collaborative relationship rather than outsourcing your thinking.\n\n### Advanced Prompting Strategies\n\n#### The Chain-of-Thought Technique\n\nBreak complex tasks into a sequence of prompts that build on each other:\n\n1. \"Help me brainstorm 5 potential topics for my sociology research paper on digital media's impact on social movements.\"\n2. \"Based on topic #3 about Twitter's role in modern protests, help me formulate a research question.\"\n3. \"Suggest a research methodology to investigate this question about Twitter's amplification of protest messages.\"\n\nThis step-by-step approach leads to more thoughtful and nuanced results.\n\n#### The Iteration Technique\n\nRefine the AI's output through follow-up prompts:\n\nInitial prompt: \"Write an introduction paragraph for my essay on sustainable urban planning.\"\n\nFollow-up prompts:\n- \"Make this introduction more engaging by adding a surprising statistic about urban growth.\"\n- \"Refine the thesis statement to be more specific about the benefits of green infrastructure.\"\n- \"Adjust the language to be more formal and academic.\"\n\nThis approach allows you to shape the AI's response toward your exact needs.\n\n#### The Perspective Technique\n\nAsk the AI to analyze a topic from multiple viewpoints:\n\n\"Explain the ethical implications of facial recognition technology from three perspectives: privacy advocates, law enforcement, and technology developers.\"\n\nThis helps develop a well-rounded understanding of complex issues.\n\n### Prompt Templates for Common Academic Tasks\n\n#### Essay Outline Template\n\n```\nI need to write a [length] [type] essay about [topic] for my [academic level] [subject] class. Please create an outline with:\n1. A clear thesis statement\n2. [number] main arguments with brief explanations\n3. Suggestions for evidence or examples to support each argument\n4. Ideas for a compelling introduction and conclusion\n```\n\n#### Research Help Template\n\n```\nI'm researching [topic] for my [assignment type]. Can you:\n1. Suggest 5 specific subtopics worth exploring\n2. Recommend 3-5 credible sources (books, journals, or databases)\n3. Provide 3 research questions that could guide my investigation\n```\n\n#### Writing Feedback Template\n\n```\nI've written the following paragraph for my [assignment type]. Please provide feedback on:\n1. Clarity of my main argument\n2. Logical flow and organization\n3. Effectiveness of evidence/examples\n4. Suggestions for improvement\n\n[paste your paragraph here]\n```\n\n### Common Prompting Pitfalls to Avoid\n\n1. **Being Too Vague**: Leads to generic, unhelpful responses\n2. **Asking for Complete Assignments**: Bypasses learning and risks academic integrity issues\n3. **Not Reviewing or Fact-Checking**: AI can generate plausible-sounding but incorrect information\n4. **Neglecting to Specify Format**: Results in content that requires significant reformatting\n5. **Forgetting Your Audience**: Not specifying academic level leads to inappropriately simple or complex content\n\n### Key Takeaways\n\n- The specificity and clarity of your prompt directly determines the quality of the AI's response\n- Breaking complex tasks into sequential prompts produces better results\n- Iterative prompting allows you to refine outputs to match your exact needs\n- Using AI as a thought partner rather than a replacement leads to better learning outcomes\n- Always review, verify, and expand on AI-generated content with your own critical thinking\n\nIn the next module, we'll explore how AI tools can enhance your research process and study sessions.",
        lesson_order: 2
      }
    ]
  },
  {
    title: "AI for Academic Research",
    description: "Using AI to enhance your research workflow",
    module_order: 2,
    lessons: [
      {
        title: "Literature Review Acceleration",
        content: "## Accelerating Your Literature Review with AI\n\nA literature review is a critical component of academic research, but it can be time-consuming. This lesson explores how AI tools can help you find, analyze, and synthesize research more efficiently.\n\n### The Literature Review Challenge\n\nTraditional literature reviews involve several labor-intensive steps:\n\n1. Finding relevant papers across multiple databases\n2. Reading and understanding dozens or hundreds of papers\n3. Identifying key themes, agreements, and contradictions\n4. Synthesizing findings into a coherent narrative\n5. Ensuring comprehensive coverage of the field\n\nAI tools can help with each of these steps, allowing you to conduct more thorough reviews in less time.\n\n### AI-Powered Research Discovery\n\n#### Specialized AI Research Tools\n\n- **Elicit**: An AI research assistant that can find papers related to your research question and extract key information like methods, results, and limitations.\n\n- **Consensus**: A specialized AI search engine for scientific research that provides summaries of findings across papers.\n\n- **Connected Papers**: Visually maps the relationships between academic papers, helping you understand the research landscape.\n\n#### Using ChatGPT for Research Discovery\n\nWhile specialized tools are ideal, you can also use general AI assistants like ChatGPT to help identify research directions with prompts like:\n\n```\nI'm beginning research on [your topic]. Can you suggest:\n1. 5-7 key subtopics I should explore\n2. 3-5 seminal papers or researchers in each subtopic\n3. Important methodological approaches used in this field\n4. Recent developments or controversies in this area\n```\n\n### AI for Paper Analysis and Summarization\n\nAfter identifying relevant papers, AI can help you process them more efficiently:\n\n#### Extracting Key Information\n\nUpload papers to specialized AI tools or use prompts like:\n\n```\nI'm reading a paper titled \"[paper title]\" by [authors]. Can you help me identify:\n1. The main research question or hypothesis\n2. The methodology used\n3. Key findings and their significance\n4. Limitations acknowledged by the authors\n5. How this connects to wider literature\n```\n\n#### Comparing Multiple Papers\n\nAI excels at identifying patterns across multiple sources:\n\n```\nI've been reading about [specific topic] in these papers: [list 3-5 papers with authors]. Can you help me compare:\n1. The different approaches or methodologies used\n2. Where their findings agree and disagree\n3. How their definitions of key terms differ\n4. Gaps that still exist in this research area\n```\n\n### Synthesizing Information with AI\n\nAfter analyzing individual papers, AI can help you synthesize information:\n\n#### Creating Literature Maps\n\n```\nBased on these papers [list papers], can you create a concept map showing:\n1. The main theories or frameworks used\n2. How different subtopics relate to each other\n3. Where there seems to be consensus vs. ongoing debate\n4. How the field has evolved over time\n```\n\n#### Generating Synthesis Drafts\n\n```\nI've analyzed these papers on [topic]: [list papers]. Can you help me draft a 500-word synthesis that:\n1. Identifies the major themes across these works\n2. Highlights agreements and contradictions\n3. Notes methodological trends\n4. Suggests where there are gaps for future research\n```\n\n### Ensuring Rigor in AI-Assisted Literature Reviews\n\nWhile AI can dramatically accelerate your literature review process, maintaining academic rigor requires:\n\n#### Critical Verification\n\n- **Always verify AI-provided citations**: AI can hallucinate or misrepresent sources\n- **Cross-check key claims**: Confirm important assertions in the original papers\n- **Validate methodological assessments**: AI may oversimplify research methods\n\n#### Addressing AI Limitations\n\n- **Knowledge cutoffs**: Most AI models have a knowledge cutoff date and won't know about very recent research\n- **Discipline-specific terminology**: AI may misunderstand specialized terms in your field\n- **Meta-analyses and statistics**: AI may struggle with complex statistical comparisons across studies\n\n### Practical Workflow: AI-Enhanced Literature Review\n\nHere's a recommended workflow that balances AI assistance with scholarly rigor:\n\n1. **Define your research question** (human-led)\n2. **Generate initial search terms and papers** (AI-assisted)\n3. **Expand your search using citation networks** (human-led with tools)\n4. **Create paper summaries for each source** (AI-assisted, human-verified)\n5. **Identify themes and patterns** (collaborative human-AI process)\n6. **Draft synthesis sections** (AI can generate, human heavily edits)\n7. **Critique and identify gaps** (human judgment with AI suggestions)\n8. **Finalize and fact-check** (primarily human-led)\n\n### Key Takeaways\n\n- AI tools can dramatically accelerate literature review by helping with discovery, analysis, and synthesis\n- Specialized research AI tools provide more accurate results than general AI assistants\n- The most effective approach combines AI efficiency with human critical thinking\n- Always verify AI-provided information, especially citations and statistical claims\n- A well-designed AI-human workflow preserves academic rigor while saving significant time\n\nIn the next lesson, we'll explore how AI can help with note-taking and information management during your research process.",
        lesson_order: 1
      },
      {
        title: "Enhanced Note-Taking Strategies",
        content: "## AI-Enhanced Note-Taking and Study Strategies\n\nEffective note-taking and study techniques are essential for academic success. This lesson explores how AI tools can transform these processes, helping you capture, organize, and retain information more effectively.\n\n### Reimagining Note-Taking with AI\n\nTraditional note-taking faces several challenges:\n- Balancing listening/reading with writing\n- Capturing complex concepts accurately\n- Organizing information logically\n- Creating notes that are useful for later study\n\nAI tools can address these challenges by automating certain aspects of the note-taking process, allowing you to focus on understanding and engagement.\n\n### AI-Powered Note Capture\n\n#### Text-Based Lecture Notes\n\n**Recording and Transcription**\n- Use tools like Otter.ai or Microsoft OneNote's transcription feature to automatically convert spoken lectures to text\n- Have AI clean up and format the transcription with proper headings, bullet points, and paragraph breaks\n\n**Example Workflow:**\n1. Record your lecture (with permission)\n2. Get an automatic transcription\n3. Use an AI prompt to refine the notes:\n\n```\nThis is a raw transcript from my [subject] lecture on [topic]. Please:\n1. Fix any grammatical errors or awkward phrasing\n2. Format with clear headings and subheadings\n3. Organize into a logical structure with bullet points\n4. Highlight key concepts, definitions, and examples\n5. Remove filler words and repetitive content\n```\n\n#### Reading and Research Notes\n\nWhen reading textbooks, articles, or papers, AI can help process and condense information:\n\n```\nI'm reading a chapter about [topic] in my [subject] textbook. Here are the main sections: [list section headings]. Can you create a note-taking template with:\n1. Key questions to answer for each section\n2. Space to record important definitions\n3. Prompts for connecting this material to previous chapters\n4. Areas to note potential exam questions\n```\n\n### Information Organization and Synthesis\n\nAfter capturing information, AI excels at helping you organize and synthesize your notes:\n\n#### Creating Summary Notes\n\n```\nHere are my notes from today's lecture on [topic]: [paste notes]\n\nPlease create a one-page summary that:\n1. Identifies 3-5 main concepts covered\n2. Explains each concept in simple terms\n3. Highlights connections between these concepts\n4. Notes potential applications or examples\n```\n\n#### Generating Concept Maps\n\nAI can help visualize relationships between ideas:\n\n```\nBased on these notes about [topic]: [paste notes]\n\nCan you describe how a concept map would look, showing:\n1. The central concept and main branches\n2. How different ideas connect to each other\n3. Hierarchical relationships between concepts\n4. Any cross-connections between different branches\n```\n\nYou can then use this description to create your own concept map using tools like MindMeister, XMind, or even pen and paper.\n\n### AI for Active Recall and Spaced Repetition\n\nResearch shows that active recall (testing yourself) and spaced repetition (reviewing at optimal intervals) are among the most effective study techniques. AI can enhance these methods:\n\n#### Generating Practice Questions\n\n```\nBased on these notes from my [subject] class: [paste notes]\n\nPlease create:\n1. 5 multiple-choice questions testing key concepts\n2. 3 short-answer questions requiring application of these concepts\n3. 2 comparative questions that connect multiple ideas\n4. 1 scenario-based question that tests deeper understanding\n```\n\n#### Creating Flashcards\n\n```\nFrom these notes on [topic]: [paste notes]\n\nPlease generate 10 flashcard pairs with:\n- Front: A key term, concept, or question\n- Back: The definition, explanation, or answer\n\nFocus on the most important information that's likely to appear on an exam.\n```\n\n#### Spaced Repetition Planning\n\n```\nI have an exam on [topic] in [timeframe, e.g., 4 weeks]. Based on these subtopics [list subtopics], can you create a spaced repetition study schedule that:\n1. Starts with broader review sessions\n2. Gradually focuses on more specific topics\n3. Includes multiple review sessions for difficult concepts\n4. Incorporates practice tests at strategic intervals\n```\n\n### Memory Enhancement Techniques with AI\n\nAI can help you apply powerful memory techniques to your study material:\n\n#### Mnemonic Creation\n\n```\nI need to memorize these concepts for my [subject] exam: [list items to memorize]\n\nCan you help me create:\n1. An acronym using the first letters of each item\n2. A memorable sentence where each word starts with the same letters\n3. A story that incorporates all these elements in sequence\n```\n\n#### Visualization Prompts\n\n```\nI'm trying to remember the process of [complex process, e.g., cellular respiration]. Can you describe 5-7 vivid, unusual, and connected images I could visualize to remember the main steps in order?\n```\n\n### Personalized Learning Enhancement\n\nAI can adapt to your specific learning needs:\n\n#### Identifying Knowledge Gaps\n\n```\nBased on my answers to these practice questions [include your answers], can you:\n1. Identify which concepts I seem to understand well\n2. Highlight areas where I might have misconceptions\n3. Suggest specific topics I should review further\n4. Recommend different approaches to learning challenging concepts\n```\n\n#### Learning Style Adaptation\n\n```\nI learn best through [your learning preference, e.g., visual examples, practical applications, stories, etc.]. Can you help me understand [difficult concept] by explaining it in a way that matches my learning style?\n```\n\n### Practical Implementation Strategies\n\nTo effectively incorporate AI into your study routine:\n\n1. **Create a consistent workflow** that combines AI assistance with your own critical thinking\n\n2. **Start small** by incorporating one AI-enhanced technique at a time\n\n3. **Customize templates** for your specific courses and learning style\n\n4. **Review and revise AI-generated content** to ensure accuracy and personal understanding\n\n5. **Use AI to complement, not replace** your own thinking and learning processes\n\n### Key Takeaways\n\n- AI can transform passive note-taking into an active learning process\n- Automated transcription and organization frees your attention for deeper engagement\n- AI excels at generating practice questions and personalized study materials\n- The most effective approach combines AI efficiency with proven learning techniques\n- The goal is not to outsource thinking but to enhance your learning capacity and outcomes\n\nIn the next lesson, we'll explore how AI can help you improve your writing process from planning to final editing.",
        lesson_order: 2
      }
    ]
  }
];

// Define Stock Market course structure
const stockMarketCourseModules = [
  {
    title: "Stock Market Basics",
    description: "Understanding how the stock market works",
    module_order: 1,
    lessons: [
      {
        title: "What are Stocks?",
        content: "## Understanding Stocks: The Building Blocks of Investing\n\nStocks represent one of the most fundamental investment vehicles in the financial markets. This lesson introduces the concept of stocks, their purpose, and why they matter to both companies and investors.\n\n### What Is a Stock?\n\nA stock (also known as a share or equity) represents partial ownership in a company. When you purchase a stock, you're buying a small piece of that business, becoming a shareholder.\n\n#### Key Characteristics of Stocks\n\n- **Ownership**: Each share represents a fraction of ownership in a company\n- **Limited Liability**: Shareholders are not personally responsible for company debts\n- **Voting Rights**: Common shareholders typically can vote on corporate decisions\n- **Transferability**: Stocks can be bought and sold on exchanges or between individuals\n- **Variable Value**: Stock prices fluctuate based on market conditions and company performance\n\n### Types of Stocks\n\n#### Common Stock vs. Preferred Stock\n\n**Common Stock**\n- Represents basic ownership interest\n- Comes with voting rights on company matters\n- May receive dividends (but not guaranteed)\n- Last in line for company assets if the company liquidates\n\n**Preferred Stock**\n- Has priority for dividend payments\n- Dividends are typically fixed\n- Usually lacks voting rights\n- Has priority over common stock in liquidation\n- May be convertible to common stock\n\n#### Other Classifications\n\n**By Company Size**\n- **Large-cap**: Companies valued at $10 billion or more (e.g., Apple, Microsoft)\n- **Mid-cap**: Companies valued between $2-10 billion\n- **Small-cap**: Companies valued between $300 million-$2 billion\n- **Micro-cap**: Companies valued under $300 million\n\n**By Investment Style**\n- **Growth stocks**: Companies expected to grow faster than the market\n- **Value stocks**: Companies that appear undervalued relative to their fundamentals\n- **Income stocks**: Companies that pay consistent, above-average dividends\n- **Cyclical stocks**: Companies whose performance follows economic cycles\n- **Defensive stocks**: Companies that tend to perform well even during economic downturns\n\n### How Companies Issue Stock\n\n#### Initial Public Offering (IPO)\n\nAn IPO is the process by which a private company first offers shares to the public. This process:\n\n1. Allows the company to raise capital for expansion, debt repayment, or other purposes\n2. Provides early investors and founders a way to monetize their ownership\n3. Increases the company's public profile and credibility\n4. Creates a market where shares can be bought and sold\n\nThe IPO process typically involves:\n- Hiring investment banks as underwriters\n- Filing extensive disclosures with regulatory authorities\n- Marketing the offering to potential investors\n- Setting an initial price and allocation for shares\n\n#### Secondary Offerings\n\nAfter an IPO, companies may issue additional shares through:\n- **Follow-on offerings**: New shares issued by the company\n- **Secondary offerings**: Existing shareholders selling their shares\n\n### Why Companies Issue Stock\n\nCompanies choose to issue stock for several reasons:\n\n1. **Capital Raising**: To fund expansion, research, debt repayment, or acquisitions\n2. **No Repayment Obligation**: Unlike debt, equity does not require repayment\n3. **Shared Risk**: Spreads financial risk across many investors\n4. **Liquidity for Founders**: Allows early investors to convert their ownership to cash\n5. **Employee Compensation**: Can offer stock options to attract and retain talent\n\n### Why Investors Buy Stocks\n\nInvestors purchase stocks with various objectives:\n\n1. **Capital Appreciation**: Profit from an increase in stock price\n2. **Dividend Income**: Regular payments distributed from company profits\n3. **Ownership Benefits**: Voting rights and influence on company direction\n4. **Inflation Protection**: Historically, stocks have outpaced inflation over long periods\n5. **Portfolio Diversification**: Reducing risk by owning different types of assets\n\n### How Stock Prices Are Determined\n\nStock prices are primarily determined by supply and demand in the marketplace. Factors influencing this include:\n\n#### Company-Specific Factors\n- Earnings and profitability\n- Revenue growth\n- Management effectiveness\n- Competitive position\n- Product innovation\n- Dividend policy\n\n#### External Factors\n- Overall economic conditions\n- Industry trends\n- Interest rates\n- Inflation expectations\n- Market sentiment and psychology\n- Geopolitical events\n\n### Reading Stock Quotes\n\nA basic stock quote typically includes:\n\n- **Ticker Symbol**: The abbreviated company identifier (e.g., AAPL for Apple)\n- **Current Price**: The most recent trading price\n- **Change**: Price movement for the current session (in rupees and percentage)\n- **Day Range**: Lowest and highest prices of the trading day\n- **52-Week Range**: Lowest and highest prices over the past year\n- **Volume**: Number of shares traded in the current session\n- **Market Cap**: Total market value of all outstanding shares\n- **P/E Ratio**: Price-to-earnings ratio, a basic valuation metric\n- **Dividend Yield**: Annual dividend as a percentage of share price\n\n### The Indian Stock Market Context\n\nIn India, the stock market has some specific characteristics:\n\n- **Major Indices**: BSE Sensex and NSE Nifty track the overall market\n- **Market Regulators**: Securities and Exchange Board of India (SEBI) oversees the market\n- **Trading Platforms**: National Stock Exchange (NSE) and Bombay Stock Exchange (BSE)\n- **Dematerialization**: Shares are held electronically in Demat accounts\n- **Market Timings**: Trading occurs from 9:15 AM to 3:30 PM, Monday through Friday\n- **Taxes**: Subject to capital gains tax and securities transaction tax (STT)\n\n### Practical Example: Understanding Stock Ownership\n\nImagine Company XYZ with 1,000,000 outstanding shares, currently trading at ₹100 per share:\n\n- Company's market capitalization: ₹100,000,000 (1,000,000 × ₹100)\n- If you buy 100 shares for ₹10,000, you own 0.01% of the company\n- If the company earns ₹5,000,000 in annual profit, your theoretical share is ₹500\n- If the company pays a dividend of ₹2 per share, you receive ₹200\n- If the stock price rises to ₹120, your investment is now worth ₹12,000, a 20% gain\n\n### Key Takeaways\n\n- Stocks represent ownership in a company and offer potential returns through price appreciation and dividends\n- Different types of stocks serve different investment objectives\n- Companies issue stocks primarily to raise capital without taking on debt\n- Stock prices are determined by supply and demand, influenced by numerous factors\n- Understanding stock basics provides a foundation for building an investment strategy\n\nIn the next lesson, we'll learn about stock exchanges and how stocks are actually bought and sold in the marketplace.",
        lesson_order: 1
      },
      {
        title: "How the Stock Market Works",
        content: "## How the Stock Market Works: Exchanges, Participants, and Trading Mechanics\n\nThe stock market is a complex ecosystem where shares of publicly traded companies are bought and sold. This lesson explains how stock markets function, the key participants involved, and the mechanics of trading.\n\n### Stock Exchanges: The Marketplace\n\nStock exchanges are organized marketplaces where securities (stocks, bonds, etc.) are traded according to standardized rules. They serve several important functions:\n\n- Providing a centralized location (physical or electronic) for trading\n- Ensuring fair and orderly markets through rules and oversight\n- Facilitating price discovery through the auction process\n- Offering liquidity by connecting buyers and sellers\n- Establishing listing requirements for companies\n\n#### Major Global Exchanges\n\n- **New York Stock Exchange (NYSE)**: The world's largest exchange by market capitalization\n- **NASDAQ**: Known for technology stocks and electronic trading\n- **Tokyo Stock Exchange (TSE)**: Japan's primary exchange\n- **London Stock Exchange (LSE)**: One of Europe's oldest exchanges\n- **Shanghai Stock Exchange (SSE)**: China's largest exchange\n\n#### Indian Stock Exchanges\n\n- **National Stock Exchange (NSE)**: India's leading stock exchange (founded 1992)\n- **Bombay Stock Exchange (BSE)**: Asia's oldest stock exchange (founded 1875)\n\n### Stock Market Participants\n\nThe stock market involves various participants, each with different roles and objectives:\n\n#### Investors\n\n- **Individual/Retail Investors**: People who buy shares for personal investment\n- **Institutional Investors**: Organizations that invest pools of money\n  - Mutual funds\n  - Pension funds\n  - Insurance companies\n  - Endowments\n  - Hedge funds\n\n#### Intermediaries\n\n- **Brokers**: Execute trades on behalf of investors for a fee or commission\n- **Dealers**: Buy and sell from their own accounts, profiting from the spread\n- **Market Makers**: Maintain liquidity by continuously offering to buy and sell specific securities\n\n#### Regulatory Bodies\n\n- **Securities and Exchange Board of India (SEBI)**: Regulates Indian securities markets\n- **Reserve Bank of India (RBI)**: Influences markets through monetary policy\n\n### How Trading Actually Works\n\n#### The Order Book\n\nAt the heart of trading is the order book, which lists all buy and sell orders for a specific security:\n\n- **Bid**: The price a buyer is willing to pay\n- **Ask/Offer**: The price a seller is willing to accept\n- **Bid-Ask Spread**: The difference between the highest bid and lowest ask\n\nExample order book for a fictional stock:\n\n```\nBids (Buyers)          Asks (Sellers)\n₹101.50 (200 shares)   ₹101.60 (300 shares)\n₹101.45 (500 shares)   ₹101.65 (150 shares)\n₹101.40 (300 shares)   ₹101.70 (500 shares)\n```\n\nThe narrower the spread, the more liquid the stock.\n\n#### Types of Orders\n\nInvestors can place several types of orders:\n\n- **Market Order**: Buy or sell immediately at the best available price\n- **Limit Order**: Buy or sell only at a specified price or better\n- **Stop Order**: Becomes a market order when a specified price is reached\n- **Stop-Limit Order**: Becomes a limit order when a specified price is reached\n- **Good-Till-Cancelled (GTC)**: Remains active until filled or cancelled\n- **Day Order**: Valid only for the current trading day\n\n#### Trading Mechanisms\n\nModern exchanges typically use one of two trading mechanisms:\n\n1. **Continuous Trading**\n   - Orders are matched continuously throughout the trading session\n   - Used during normal trading hours on most exchanges\n\n2. **Call Auction/Periodic Trading**\n   - Orders accumulate and are matched at specific times\n   - Often used at market opening, closing, or for less liquid securities\n\n### The Trading Day in India\n\nA typical trading day on Indian exchanges follows this schedule:\n\n- **Pre-opening Session (9:00-9:15 AM)**\n  - Orders placed but not executed\n  - Used to determine opening prices\n\n- **Normal Trading (9:15 AM-3:30 PM)**\n  - Continuous matching of buy and sell orders\n  - Real-time price updates\n\n- **Closing Session (3:30-3:40 PM)**\n  - Call auction to determine closing prices\n  - Important for index values and derivatives settlement\n\n- **Post-closing Session (3:40-4:00 PM)**\n  - For specific order types at closing price\n\n### From Traditional to Electronic Trading\n\nStock markets have evolved from physical trading floors to electronic networks:\n\n1. **Open Outcry System (Traditional)**\n   - Traders met physically on exchange floors\n   - Communicated through hand signals and verbal calls\n   - Gradually phased out globally\n\n2. **Electronic Trading (Modern)**\n   - Computerized matching of orders\n   - Faster execution and greater transparency\n   - Lower costs and greater accessibility\n   - Enables algorithmic and high-frequency trading\n\n### Market Indices: Measuring Performance\n\nMarket indices track the performance of specific groups of stocks:\n\n#### Major Indian Indices\n\n- **NIFTY 50**: Includes 50 large companies across sectors on the NSE\n- **BSE SENSEX**: Includes 30 large, well-established companies on the BSE\n- **NIFTY Next 50**: The next 50 largest companies after the NIFTY 50\n- **Sector-specific indices**: Banking, IT, Pharma, etc.\n\n#### How Indices Are Calculated\n\nIndices can be calculated using different methodologies:\n\n- **Price-weighted**: Based on the stock prices (e.g., Dow Jones)\n- **Market-cap weighted**: Based on total market value (e.g., NIFTY, SENSEX)\n- **Equal-weighted**: Each stock has equal importance regardless of price or size\n- **Fundamental-weighted**: Based on fundamental measures like revenue or dividends\n\n### Circuit Breakers and Trading Halts\n\nTo maintain market stability, exchanges implement circuit breakers:\n\n- **Stock-specific Circuits**: Limits on how much an individual stock can move\n- **Market-wide Circuits**: Triggered by significant moves in broad indices\n\nIn India, market-wide circuit breakers are triggered at three levels:\n- 10% movement: 45-minute halt (if before 1:00 PM), 15-minute halt (if between 1:00-2:30 PM), or market closed (if after 2:30 PM)\n- 15% movement: 1-hour 45-minute halt (if before 1:00 PM), 45-minute halt (if between 1:00-2:30 PM), or market closed (if after 2:30 PM)\n- 20% movement: Market closed for the day\n\n### Trading Costs and Considerations\n\nInvesting in the stock market involves various costs:\n\n- **Brokerage Fees**: Charges for executing trades (per trade or percentage)\n- **Securities Transaction Tax (STT)**: Tax on buying and selling securities\n- **Goods and Services Tax (GST)**: Applied on brokerage and other services\n- **Demat Account Charges**: Maintenance fees for electronic holdings\n- **Capital Gains Tax**: Tax on profits from selling shares\n\n### Practical Example: Trading Process\n\nLet's walk through a hypothetical trade in the Indian context:\n\n1. Investor decides to buy 100 shares of Infosys and places a limit order at ₹1,500 through their broker\n2. The order enters the exchange's order book\n3. When a seller is willing to sell at ₹1,500 or lower, the trade executes\n4. The exchange confirms the transaction to both parties\n5. Settlement occurs in T+2 days (trade date plus two business days)\n6. Shares are deposited in the buyer's Demat account\n7. Money is debited from the buyer's trading account\n8. The investor pays applicable charges (brokerage, STT, GST)\n\n### Key Takeaways\n\n- Stock exchanges provide organized, regulated marketplaces for trading securities\n- Various participants including investors, brokers, and regulators make up the market ecosystem\n- Trading mechanics involve matching buy and sell orders through order books\n- Different order types allow investors to control how their trades are executed\n- Understanding trading mechanics helps investors execute their strategies more effectively\n- Electronic trading has made markets more accessible but also more complex\n\nIn the next lesson, we'll explore fundamental analysis and how to evaluate stocks based on company performance and valuation metrics.",
        lesson_order: 2
      }
    ]
  },
  {
    title: "Investment Strategies",
    description: "Different approaches to stock investing",
    module_order: 2,
    lessons: [
      {
        title: "Fundamental Analysis Basics",
        content: "## Fundamental Analysis: Evaluating the True Value of Stocks\n\nFundamental analysis is a method of evaluating a stock by examining the company's underlying business fundamentals. This lesson introduces the key concepts, tools, and metrics used in fundamental analysis to determine a stock's intrinsic value.\n\n### Understanding Fundamental Analysis\n\nFundamental analysis is based on the premise that a stock's price should eventually reflect the true value (intrinsic value) of the underlying business. The goal is to:\n\n- Determine if a stock is overvalued, undervalued, or fairly valued\n- Identify companies with strong business models and financial health\n- Make investment decisions based on comprehensive research rather than market sentiment\n- Take a typically longer-term approach to investing\n\n### Top-Down vs. Bottom-Up Approaches\n\nFundamental analysts typically use one of two approaches:\n\n#### Top-Down Analysis\n\nStarts with the big picture and narrows down to specific investments:\n1. **Macroeconomic Analysis**: Evaluate overall economic conditions\n2. **Sector/Industry Analysis**: Identify promising sectors based on economic outlook\n3. **Company Analysis**: Select the best companies within those sectors\n\n#### Bottom-Up Analysis\n\nFocuses on individual companies regardless of broader trends:\n1. **Company-Specific Research**: Analyze financials, management, competitive position\n2. **Comparative Analysis**: Compare to peers within the industry\n3. **Valuation**: Determine intrinsic value and compare to current market price\n\n### Sources of Information for Fundamental Analysis\n\nFundamental analysts rely on various information sources:\n\n- **Financial Statements**: Balance sheet, income statement, cash flow statement\n- **Annual Reports**: Comprehensive overview of company performance and future plans\n- **Quarterly Earnings Reports**: Updated financial information and guidance\n- **Management Discussions**: Insights from company executives\n- **Industry Reports**: Trends and competitive landscape analysis\n- **Economic Data**: GDP growth, interest rates, inflation, etc.\n- **News and Events**: Corporate actions, regulatory changes, etc.\n\n### Analyzing Financial Statements\n\nFinancial statements provide the quantitative data needed for fundamental analysis:\n\n#### Balance Sheet\n\nShows what a company owns (assets) and owes (liabilities) at a specific point in time.\n\n**Key items to examine:**\n- **Assets**: Cash, investments, accounts receivable, inventory, property/equipment\n- **Liabilities**: Debt, accounts payable, accrued expenses\n- **Shareholders' Equity**: Retained earnings, additional paid-in capital\n- **Debt-to-Equity Ratio**: How much leverage the company is using\n- **Current Ratio**: Short-term financial health (current assets ÷ current liabilities)\n\n#### Income Statement\n\nShows revenue, expenses, and profit over a period (usually quarter or year).\n\n**Key items to examine:**\n- **Revenue**: Total sales or service income\n- **Cost of Goods Sold (COGS)**: Direct costs of producing goods/services\n- **Gross Profit and Margin**: Revenue - COGS and as a percentage\n- **Operating Expenses**: Sales, general, administrative, R&D costs\n- **Operating Income**: Profit from core business operations\n- **Net Income**: Final profit after all expenses and taxes\n- **Earnings Per Share (EPS)**: Net income ÷ outstanding shares\n\n#### Cash Flow Statement\n\nTracks the actual cash moving in and out of the business.\n\n**Key items to examine:**\n- **Operating Cash Flow**: Cash generated from core business\n- **Investing Cash Flow**: Cash used for investments in assets and securities\n- **Financing Cash Flow**: Cash from debt, equity issuance, dividends, buybacks\n- **Free Cash Flow**: Operating cash flow - capital expenditures\n\n### Key Financial Ratios and Metrics\n\nRatios help compare companies and assess value:\n\n#### Valuation Ratios\n\n- **Price-to-Earnings (P/E) Ratio**: Stock price ÷ earnings per share\n  - Higher ratios indicate higher growth expectations\n  - Indian market average P/E typically ranges from 15-25\n\n- **Price-to-Book (P/B) Ratio**: Stock price ÷ book value per share\n  - Values under 1 may indicate undervaluation (but could also indicate problems)\n\n- **Price-to-Sales (P/S) Ratio**: Market cap ÷ annual revenue\n  - Useful for comparing companies with negative earnings\n\n- **Enterprise Value to EBITDA (EV/EBITDA)**: (Market cap + debt - cash) ÷ EBITDA\n  - Considers total company value, not just equity\n\n#### Profitability Ratios\n\n- **Return on Equity (ROE)**: Net income ÷ shareholders' equity\n  - Measures efficiency of using shareholder capital\n\n- **Return on Assets (ROA)**: Net income ÷ total assets\n  - Shows how efficiently assets generate earnings\n\n- **Profit Margins**: Various margins (gross, operating, net)\n  - Higher margins generally indicate stronger business models\n\n#### Growth Metrics\n\n- **Revenue Growth Rate**: Year-over-year increase in sales\n- **Earnings Growth Rate**: Year-over-year increase in EPS\n- **Dividend Growth Rate**: Historical increase in dividend payments\n\n### Dividend Analysis\n\nFor income-oriented investors, dividend metrics are important:\n\n- **Dividend Yield**: Annual dividend ÷ stock price\n- **Dividend Payout Ratio**: Dividends paid ÷ net income\n  - Lower ratios (30-50%) may indicate more sustainable dividends\n- **Dividend Coverage Ratio**: EPS ÷ dividend per share\n  - Higher values indicate safer dividends\n\n### Qualitative Factors in Fundamental Analysis\n\nBeyond numbers, these qualitative factors are crucial:\n\n- **Business Model**: How the company makes money\n- **Competitive Advantage**: Moats that protect from competition\n- **Industry Position**: Leadership, market share, pricing power\n- **Management Quality**: Track record, incentives, governance\n- **Growth Catalysts**: New products, markets, technologies\n- **Risks**: Regulatory, competitive, technological, financial\n\n### Determining Intrinsic Value\n\nAfter collecting and analyzing information, analysts use various methods to calculate intrinsic value:\n\n#### Discounted Cash Flow (DCF)\n\nCalculates the present value of expected future cash flows.\nSteps include:\n1. Estimate future free cash flows\n2. Choose an appropriate discount rate (usually weighted average cost of capital)\n3. Calculate terminal value\n4. Sum the discounted values\n\n#### Comparable Company Analysis\n\nCompares valuation multiples with similar companies to identify relative value.\n\n#### Asset-Based Valuation\n\nEstimates value based on company assets minus liabilities, useful for asset-heavy businesses.\n\n### Practical Application: A Simplified Framework\n\nFor beginners, this simplified fundamental analysis framework can be helpful:\n\n1. **Business Understanding**\n   - What does the company do?\n   - How does it make money?\n   - Who are its competitors?\n   - What advantages does it have?\n\n2. **Financial Health Check**\n   - Is revenue growing consistently?\n   - Are profits growing in line with or faster than revenue?\n   - Is the company generating positive free cash flow?\n   - Is debt at a manageable level?\n\n3. **Valuation Assessment**\n   - How does the P/E ratio compare to the industry average and historical range?\n   - Are there reasons (growth rate, business quality) that justify a premium valuation?\n   - What would happen to the stock price if valuation multiples contracted?\n\n4. **Risk Evaluation**\n   - What could go wrong with the investment thesis?\n   - Are there industry or company-specific risks?\n   - How might economic changes affect the company?\n\n### Indian Market Considerations\n\nWhen applying fundamental analysis to Indian stocks, consider these factors:\n\n- **Promoter Holdings**: Founder/family ownership is often higher than in Western markets\n- **Corporate Governance**: Varies significantly across companies\n- **Related Party Transactions**: May affect true profitability\n- **Tax Considerations**: Corporate tax rates and implications\n- **Sector-Specific Metrics**: Different industries may have unique important metrics\n\n### Key Takeaways\n\n- Fundamental analysis focuses on the underlying business rather than short-term price movements\n- Financial statements provide the quantitative data for analysis\n- Ratios and metrics help compare companies and assess value\n- Qualitative factors like business model and management quality are equally important\n- The goal is to determine intrinsic value and compare it to market price\n- A disciplined, thorough approach to fundamental analysis can lead to better investment decisions\n\nIn the next lesson, we'll explore technical analysis as an alternative approach to evaluating stocks based on price patterns and market psychology.",
        lesson_order: 1
      },
      {
        title: "Technical Analysis Overview",
        content: "## Technical Analysis: Reading Chart Patterns and Market Psychology\n\nUnlike fundamental analysis, which focuses on a company's business performance, technical analysis examines stock price movements and trading volume to forecast future price direction. This lesson introduces the key concepts, tools, and patterns used in technical analysis.\n\n### Understanding Technical Analysis\n\nTechnical analysis is based on three core principles:\n\n1. **Market Action Discounts Everything**: All known information is already reflected in prices\n2. **Prices Move in Trends**: Once established, trends are more likely to continue than reverse\n3. **History Tends to Repeat**: Market patterns recur because investor psychology remains constant\n\nTechnical analysts (or \"technicians\") believe that:\n- Studying price action can predict future price movements\n- Chart patterns reflect collective market psychology\n- Timing is more important than long-term valuation\n\n### Types of Charts\n\nTechnical analysts use several chart types to visualize price movement:\n\n#### Line Charts\n\n- Simplest form, showing closing prices connected by lines\n- Provides a clean view of overall price trends\n- Less detailed than other chart types\n\n#### Bar Charts\n\n- Each bar shows open, high, low, and close (OHLC) for a time period\n- Vertical line represents the price range (high to low)\n- Left horizontal tick is the opening price\n- Right horizontal tick is the closing price\n\n#### Candlestick Charts\n\n- Japanese origin, now the most popular chart type\n- Each \"candle\" shows OHLC data\n- Filled/colored candle: close lower than open (bearish)\n- Hollow/different color candle: close higher than open (bullish)\n- Upper and lower \"wicks\" show high and low prices\n\n#### Point and Figure Charts\n\n- Focus only on significant price movements\n- Filter out minor price fluctuations\n- Use X's and O's to represent rising and falling prices\n\n### Timeframes in Technical Analysis\n\nCharts can be constructed for various timeframes:\n\n- **Intraday**: 1-minute, 5-minute, 15-minute, hourly\n- **Daily**: Each point represents one trading day\n- **Weekly and Monthly**: For longer-term perspective\n- **Yearly**: For very long-term analysis\n\nDifferent timeframes serve different purposes:\n- Shorter timeframes: useful for day trading and short-term positions\n- Longer timeframes: better for identifying major trends and support/resistance levels\n\n### Core Technical Analysis Concepts\n\n#### Trend Analysis\n\nIdentifying the direction of price movement:\n\n- **Uptrend**: Series of higher highs and higher lows\n- **Downtrend**: Series of lower highs and lower lows\n- **Sideways/Horizontal Trend**: Price moves within a horizontal channel\n\nTrend lines are drawn by connecting successive lows (in uptrends) or highs (in downtrends).\n\n#### Support and Resistance\n\nKey price levels where buying or selling pressure is expected:\n\n- **Support**: Price level where buying pressure overcomes selling pressure, preventing further decline\n- **Resistance**: Price level where selling pressure overcomes buying pressure, preventing further rise\n\nWhen broken, support often becomes resistance and vice versa – a concept called role reversal.\n\n#### Volume Analysis\n\nTrading volume provides insight into the strength of price movements:\n\n- **High volume**: More participation and conviction behind the move\n- **Low volume**: Less conviction and potentially less sustainable moves\n- **Volume increasing with price**: Confirms the trend\n- **Volume decreasing with price**: Suggests weakening trend\n\n#### Moving Averages\n\nLines representing the average price over a specific period:\n\n- **Simple Moving Average (SMA)**: Equal weight to all prices in the period\n- **Exponential Moving Average (EMA)**: More weight to recent prices\n\nCommon periods include 50-day, 100-day, and 200-day moving averages.\n\nMoving averages help identify:\n- Trend direction (price above MA = uptrend)\n- Support and resistance levels\n- Crossovers (short-term MA crossing long-term MA as signals)\n\n### Technical Indicators\n\nMathematical calculations based on price and/or volume that help identify market conditions:\n\n#### Trend Indicators\n\n- **Moving Average Convergence Divergence (MACD)**\n  - Calculates the difference between two EMAs (typically 12 and 26-period)\n  - Signal line is usually 9-period EMA of the MACD line\n  - Signals include line crossovers and divergences\n\n- **Average Directional Index (ADX)**\n  - Measures trend strength regardless of direction\n  - Readings above 25 indicate strong trend\n  - Used with Directional Movement Indicators (DMI)\n\n#### Momentum Indicators\n\n- **Relative Strength Index (RSI)**\n  - Measures speed and change of price movements on scale of 0-100\n  - Values above 70 considered overbought\n  - Values below 30 considered oversold\n\n- **Stochastic Oscillator**\n  - Compares closing price to price range over specific period\n  - Values above 80 indicate overbought conditions\n  - Values below 20 indicate oversold conditions\n\n#### Volatility Indicators\n\n- **Bollinger Bands**\n  - Consist of a middle band (20-day SMA) and two outer bands\n  - Outer bands are typically 2 standard deviations from the middle\n  - Widening bands indicate increasing volatility\n  - Narrowing bands suggest decreasing volatility\n\n- **Average True Range (ATR)**\n  - Measures market volatility\n  - Higher values indicate higher volatility\n  - Used to set stop-loss levels and position sizing\n\n### Chart Patterns\n\nRecognizable configurations that may indicate continuation or reversal of trends:\n\n#### Reversal Patterns\n\n- **Head and Shoulders**\n  - Consists of three peaks with the middle one (head) higher than the others (shoulders)\n  - Neckline connects the troughs between peaks\n  - Signals potential trend reversal from bullish to bearish\n\n- **Inverse Head and Shoulders**\n  - Reverse of head and shoulders pattern\n  - Signals potential trend reversal from bearish to bullish\n\n- **Double Top/Bottom**\n  - Double top: Two similar peaks signals potential downtrend\n  - Double bottom: Two similar troughs signals potential uptrend\n\n- **Triple Top/Bottom**\n  - Similar to double patterns but with three peaks or troughs\n\n#### Continuation Patterns\n\n- **Flags and Pennants**\n  - Short-term consolidation patterns following a sharp price move\n  - Suggest brief pause before continuing in the same direction\n\n- **Triangles**\n  - **Ascending Triangle**: Horizontal resistance with rising support\n  - **Descending Triangle**: Horizontal support with falling resistance\n  - **Symmetrical Triangle**: Converging support and resistance\n\n- **Rectangle**\n  - Price bounces between parallel support and resistance\n  - Breakout direction indicates next trend\n\n### Candlestick Patterns\n\nJapanese candlestick patterns provide insights into market psychology:\n\n#### Single Candlestick Patterns\n\n- **Doji**: Open and close at nearly the same level, indicating indecision\n- **Hammer**: Small body with long lower shadow, potential bullish reversal\n- **Shooting Star**: Small body with long upper shadow, potential bearish reversal\n- **Marubozu**: Candlestick with no shadows, indicating strong conviction\n\n#### Multiple Candlestick Patterns\n\n- **Engulfing Patterns**: Larger candle completely \"engulfs\" previous candle\n- **Harami**: Small candle contained within previous larger candle\n- **Morning Star**: Three-candle pattern signaling potential bullish reversal\n- **Evening Star**: Three-candle pattern signaling potential bearish reversal\n\n### Applying Technical Analysis in Indian Markets\n\nWhen using technical analysis in Indian markets, consider these factors:\n\n- **Market Hours**: NSE/BSE trading hours (9:15 AM to 3:30 PM)\n- **Circuit Limits**: Daily price limits affect how patterns form\n- **Liquidity Considerations**: Some stocks may have low liquidity, affecting pattern reliability\n- **Index-Specific Patterns**: Nifty and Sensex may exhibit different characteristics than individual stocks\n\n### Practical Technical Analysis Framework\n\nFor beginners, this simplified framework can help apply technical analysis effectively:\n\n1. **Identify the Overall Trend**\n   - Check longer-term charts first (weekly, daily)\n   - Determine primary trend direction\n   - Use moving averages to confirm\n\n2. **Spot Key Support and Resistance Levels**\n   - Mark significant price levels where reversals occurred\n   - Note psychological levels (round numbers)\n   - Identify moving averages that have acted as support/resistance\n\n3. **Look for Confirming Indicators**\n   - Volume patterns supporting price moves\n   - Momentum indicators confirming or diverging from price\n   - Multiple indicators agreeing on the same signal\n\n4. **Identify Entry and Exit Points**\n   - Look for established patterns nearing completion\n   - Wait for confirmation of breakouts\n   - Set clear stop-loss levels based on support/resistance\n\n5. **Manage Risk**\n   - Never risk more than a small percentage on any trade\n   - Consider volatility when setting position sizes\n   - Have a clear exit strategy for both profit and loss\n\n### Limitations of Technical Analysis\n\nWhile useful, technical analysis has limitations:\n\n- Patterns don't always work as expected\n- Subject to confirmation bias and interpretation\n- May fail during unexpected events (earnings surprises, economic shocks)\n- Works better in liquid markets with many participants\n- Often most effective when combined with fundamental analysis\n\n### Key Takeaways\n\n- Technical analysis focuses on price movements, patterns, and market psychology\n- Different chart types provide various perspectives on price action\n- Support, resistance, and trend analysis form the foundation of technical analysis\n- Technical indicators provide additional insight into price momentum and trend strength\n- Chart patterns may signal continuation or reversal of existing trends\n- Most successful traders combine multiple technical tools rather than relying on a single indicator\n- Risk management is crucial regardless of the technical signals\n\nIn the next lesson, we'll explore practical investment strategies combining both fundamental and technical analysis for the Indian stock market.",
        lesson_order: 2
      }
    ]
  }
];

// Function to initialize courses
async function createCourses(): Promise<InitResult> {
  try {
    // Define course titles for checking existence
    const aiToolsTitle = "AI Tools Mastery";
    const stockMarketTitle = "Stock Market Fundamentals";
    
    console.log(`Checking for courses with titles: '${aiToolsTitle}' and '${stockMarketTitle}'`);
    
    // Attempt to create AI Tools course if it doesn't exist
    const { data: aiToolsCourseExists, error: aiToolsCheckError } = await supabase
      .from('courses')
      .select('id, title')
      .eq('title', aiToolsTitle)
      .single();
    
    if (aiToolsCheckError && aiToolsCheckError.code !== 'PGRST116') {
      console.error("Error checking AI Tools course:", aiToolsCheckError);
    }
    
    // Attempt to create Stock Market course if it doesn't exist
    const { data: stockMarketCourseExists, error: stockMarketCheckError } = await supabase
      .from('courses')
      .select('id, title')
      .eq('title', stockMarketTitle)
      .single();
    
    if (stockMarketCheckError && stockMarketCheckError.code !== 'PGRST116') {
      console.error("Error checking Stock Market course:", stockMarketCheckError);
    }
    
    // Create AI Tools course if not found
    if (!aiToolsCourseExists) {
      console.log(`Creating AI Tools course: ${aiToolsTitle}`);
      const { data: aiToolsCourse, error: createAiToolsError } = await supabase
        .from('courses')
        .insert([
          {
            title: aiToolsTitle,
            description: "Learn how to leverage AI tools effectively for academic and professional success",
            price: 500,
            referral_reward: 250,
            pdf_url: "https://example.com/ai-tools-course.pdf"
          }
        ])
        .select()
        .single();
      
      if (createAiToolsError) {
        console.error("Error creating AI Tools course:", createAiToolsError);
        return { success: false, error: createAiToolsError };
      }
      
      if (aiToolsCourse) {
        // Create modules and lessons for AI Tools course
        await createModulesAndLessons(aiToolsCourse.id, aiToolsCourseModules);
      }
    } else {
      console.log(`AI Tools course already exists with ID: ${aiToolsCourseExists.id}`);
    }
    
    // Create Stock Market course if not found
    if (!stockMarketCourseExists) {
      console.log(`Creating Stock Market course: ${stockMarketTitle}`);
      const { data: stockMarketCourse, error: createStockMarketError } = await supabase
        .from('courses')
        .insert([
          {
            title: stockMarketTitle,
            description: "Learn the fundamentals of stock market investing with practical examples",
            price: 1000,
            referral_reward: 500,
            pdf_url: "https://example.com/stock-market-course.pdf"
          }
        ])
        .select()
        .single();
      
      if (createStockMarketError) {
        console.error("Error creating Stock Market course:", createStockMarketError);
        return { success: false, error: createStockMarketError };
      }
      
      if (stockMarketCourse) {
        // Create modules and lessons for Stock Market course
        await createModulesAndLessons(stockMarketCourse.id, stockMarketCourseModules);
      }
    } else {
      console.log(`Stock Market course already exists with ID: ${stockMarketCourseExists.id}`);
    }
    
    return { success: true, message: "Courses initialized successfully" };
  } catch (error) {
    console.error("Error in createCourses:", error);
    return { success: false, error };
  }
}

// Helper function to create modules and lessons for a course
async function createModulesAndLessons(courseId: string, moduleData: any[]) {
  try {
    console.log(`Creating modules and lessons for course ID: ${courseId}`);
    
    for (const module of moduleData) {
      // Create the module
      const { data: createdModule, error: moduleError } = await supabase
        .from('course_modules')
        .insert([
          {
            course_id: courseId,
            title: module.title,
            description: module.description,
            module_order: module.module_order,
            content: module.description  // Using description as content for simplicity
          }
        ])
        .select()
        .single();
      
      if (moduleError) {
        console.error(`Error creating module "${module.title}":`, moduleError);
        continue;
      }
      
      if (createdModule && module.lessons) {
        // Create lessons for this module
        for (const lesson of module.lessons) {
          const { error: lessonError } = await supabase
            .from('lessons')
            .insert([
              {
                module_id: createdModule.id,
                title: lesson.title,
                content: lesson.content,
                lesson_order: lesson.lesson_order
              }
            ]);
          
          if (lessonError) {
            console.error(`Error creating lesson "${lesson.title}":`, lessonError);
          }
        }
      }
    }
    
    console.log(`Successfully created modules and lessons for course ID: ${courseId}`);
  } catch (error) {
    console.error("Error in createModulesAndLessons:", error);
    throw error;
  }
}
